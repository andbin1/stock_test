# 📊 Excel导出使用指南

快速生成包含完整交易明细的Excel报告，方便你校对和分析。

---

## 📂 生成的Excel文件

| 文件名 | 用途 | 何时生成 |
|--------|------|--------|
| `交易明细_000001.xlsx` | 单只股票的详细交易 | 演示或完整回测后 |
| `回测详情_沪深300.xlsx` | 沪深300所有交易汇总 | 完整回测后 |
| `回测详情_中证500.xlsx` | 中证500所有交易汇总 | 完整回测后 |

---

## 🚀 快速生成方式

### 方式1️⃣: 快速生成演示Excel（推荐）

```bash
python quick_excel_export.py
```

一键生成5个股票的详细Excel报告：
- 交易明细_000001.xlsx
- 交易明细_000651.xlsx
- 交易明细_000858.xlsx
- 交易明细_600000.xlsx
- 交易明细_601399.xlsx

⏱️ **耗时**: 5秒

### 方式2️⃣: 完整回测时自动生成

```bash
python main.py
```

完整回测完成后，自动生成：
- 回测详情_沪深300.xlsx
- 回测详情_中证500.xlsx

⏱️ **耗时**: 20分钟（完整回测）

---

## 📋 Excel文件结构

每个Excel文件包含4个Sheet页：

### 1️⃣ 【交易摘要】Sheet页

显示整体统计信息：

```
股票代码: 000001
生成时间: 2025-02-13 15:30:45
数据范围: 2024-01-02 到 2025-02-13

统计信息
总交易数: 8
总收益率%: +15.67
平均每笔%: +1.96
最高收益%: +5.23
最低收益%: -1.45
胜率%: 62.5
```

---

### 2️⃣ 【交易清单】Sheet页 ⭐ **用于校对**

包含所有买卖点的详细信息：

| 序号 | 股票代码 | 买入日期 | 买入时间 | 买入价 | 卖出日期 | 卖出时间 | 卖出价 | 持有天数 | 收益率% | 状态 |
|------|---------|---------|---------|--------|---------|---------|--------|---------|---------|------|
| 1 | 000001 | 2024-07-24 | 09:30:00 | 13.33 | 2024-07-27 | 14:57:00 | 14.40 | 3 | +7.94 | 平仓 |
| 2 | 000001 | 2024-09-22 | 09:30:00 | 15.74 | 2024-09-25 | 14:57:00 | 19.19 | 3 | +21.79 | 平仓 |
| ... | | | | | | | | | | |

**颜色标注**:
- 🟢 **绿色**: 盈利交易（收益率% > 0）
- 🔴 **红色**: 亏损交易（收益率% < 0）

**列说明**:
- **买入日期/时间**: 买入信号产生的时间
- **买入价**: 该日的收盘价（成交价格）
- **卖出日期/时间**: 3个交易日后的卖出时间
- **卖出价**: 卖出日的收盘价
- **持有天数**: 固定为3天（根据策略参数）
- **收益率%**: 已扣除手续费的净收益率
- **状态**: 平仓/未平仓

---

### 3️⃣ 【信号点详情】Sheet页 ⭐ **用于验证条件**

显示所有满足策略条件的交易点及其详细指标：

| 日期 | 收盘价 | MA5 | MA30 | 成交量 | MA20均量 | MA30向上 | 量能放大 | 5日线回踩 | BUY | SELL |
|------|--------|------|------|--------|---------|---------|---------|----------|-----|------|
| 2024-07-24 | 13.33 | 13.10 | 12.80 | 1520 | 850 | 是 | 是 | 是 | BUY | |
| 2024-07-25 | 13.50 | 13.25 | 12.95 | 1200 | 880 | 是 | 否 | 否 | | |
| 2024-07-27 | 14.40 | 13.80 | 13.10 | 950 | 900 | 是 | 否 | 否 | | SELL |
| ... | | | | | | | | | | |

**条件说明**:
- **MA30向上**: MA30 > 前一天的MA30
- **量能放大**: 成交量 > MA20均量 × 2.0倍
- **5日线回踩**: 收盘价 < MA5

**买入信号**: 三个条件同时满足（是、是、是）
**卖出信号**: 买入后第3个交易日

---

### 4️⃣ 【策略参数】Sheet页

记录本次回测使用的参数配置：

```
参数配置

MA周期（天）        30
量能放大倍数        2.0
5日线周期          5
持有天数            3
数据范围           2024-01-02 到 2025-02-13
```

修改这些参数可以改变策略的行为。

---

## 🔍 如何校对交易

### 步骤1: 打开Excel文件

```
交易明细_000001.xlsx
```

### 步骤2: 查看【交易清单】

检查以下内容：

- ✓ **买入日期**是否合理（是否在上升趋势中）
- ✓ **买入价格**是否正确
- ✓ **卖出日期**是否恰好是3个交易日后
- ✓ **收益率**是否计算正确（(卖出价-买入价)/买入价）
- ✓ **颜色标注**是否正确（绿色应为正收益）

### 步骤3: 验证策略条件

切换到【信号点详情】Sheet页：

- ✓ **BUY信号**的那一行应该显示: MA30向上=是, 量能放大=是, 5日线回踩=是
- ✓ **SELL信号**应该恰好是BUY信号之后的第3个交易日
- ✓ 验证成交量是否真的有明显放大

---

## 🛠️ 调整参数后重新生成

### 步骤1: 修改参数

编辑 `config.py`:

```python
STRATEGY_PARAMS = {
    "ma_period": 30,          # 修改这些参数
    "volume_multiplier": 2.0,
    "hold_days": 3,
}
```

### 步骤2: 重新生成Excel

```bash
# 生成演示Excel
python quick_excel_export.py

# 或完整回测
python main.py
```

### 步骤3: 对比结果

打开新的Excel文件，对比：
- 交易数是否增加/减少
- 总收益是否提高
- 胜率是否改善

---

## 💡 常见用法

### 用法1: 快速验证策略

```bash
# 1. 生成Excel
python quick_excel_export.py

# 2. 打开 交易明细_000001.xlsx
# 3. 查看【交易清单】验证逻辑
# 4. 如果满意，修改参数

# 5. 修改config.py参数
# 6. 重新生成Excel
python quick_excel_export.py

# 7. 对比新旧Excel的结果
```

### 用法2: 完整生产回测

```bash
# 1. 运行完整回测
python main.py

# 2. 等待20-30分钟

# 3. 打开生成的Excel文件
#    - 回测详情_沪深300.xlsx
#    - 回测详情_中证500.xlsx

# 4. 在【汇总对比】Sheet页查看所有股票的结果
# 5. 在各股票Sheet页查看详细交易
```

### 用法3: 导出到其他系统

如果需要导出到其他系统（如交易软件、分析工具）：

```bash
# 1. 生成Excel后
# 2. 在Excel中选择【交易清单】Sheet页
# 3. 复制数据到CSV或其他格式
# 4. 导入到目标系统
```

---

## 📊 理解收益率计算

Excel中的收益率% 已包含手续费：

```
收益率% = (卖出价 - 买入价) / 买入价 × 100 - 手续费
        = (卖出价 - 买入价) / 买入价 × 100 - 0.1

示例：
买入价: 10.00
卖出价: 10.50
毛收益: (10.50 - 10.00) / 10.00 × 100 = 5.00%
手续费: 0.1%
净收益: 5.00% - 0.1% = 4.90%
```

---

## ⚠️ 注意事项

1. **时间精度**: 演示数据中的买入/卖出时间是模拟的
   - 实际生产回测中会使用真实交易时间

2. **价格来源**: 所有价格来自akshare数据源
   - 与你的交易软件可能略有偏差

3. **手续费**: 已按0.1%计算（往返0.1%）
   - 实际手续费可能不同，需要在config中调整

4. **停牌/停交易**: 当前版本不处理停牌
   - 某些特殊时期可能导致结果偏差

---

## 🎯 后续优化

- [ ] 添加止损/止盈
- [ ] 导出到更多格式（PDF、HTML等）
- [ ] 支持自定义表头和计算
- [ ] 添加风险指标（夏普比率、最大回撤等）
- [ ] 支持实时数据更新

---

## 📞 常见问题

**Q: 为什么收益率和我手工计算的不一样？**
A: 确认已包含手续费0.1%。计算公式: (卖出价-买入价)/买入价 - 0.1%

**Q: 能否改变Excel的格式？**
A: 可以在 `export_to_excel.py` 中修改样式（字体、颜色、宽度等）

**Q: 如何导出更多股票的交易？**
A: 修改 `quick_excel_export.py` 中的 `stocks` 列表，添加更多代码

**Q: 数据是实时的吗？**
A: 演示数据是模拟的。完整回测 `python main.py` 使用真实数据。

---

**版本**: 1.0
**最后更新**: 2025-02-13

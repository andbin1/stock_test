# 项目结构说明

完整的A股交易策略快速回测系统已为你搭建完成。

## 📁 文件清单

### 📌 入口文件

| 文件 | 用途 | 运行时间 |
|------|------|--------|
| `run.bat` | Windows一键运行菜单 | - |
| `run.sh` | Linux/Mac一键运行菜单 | - |
| `quick_test.py` | 快速测试（5只股票） | ~3分钟 |
| `main.py` | **完整回测**（推荐首先运行） | 15-30分钟 |
| `param_optimizer.py` | 参数优化（网格搜索） | 30-60分钟 |

### 🔧 核心模块

| 文件 | 职责 | 详情 |
|------|------|------|
| `config.py` | 配置管理 | 策略参数、时间范围、指数选择 |
| `strategy.py` | 交易策略 | 30MA向上+量能放大+5日线回踩+3日持有 |
| `data_fetcher.py` | 数据获取 | 从akshare获取A股指数成分股和历史数据 |
| `backtest_engine.py` | 回测引擎 | 执行回测，计算绩效指标 |
| `visualizer.py` | 可视化 | 生成图表和报告 |

### 📚 文档

| 文件 | 内容 |
|------|------|
| `QUICKSTART.md` | ⭐ **从这里开始**（5分钟快速开始） |
| `README.md` | 项目概览和核心概念 |
| `USAGE.md` | 详细使用指南 |
| `PROJECT_STRUCTURE.md` | 本文件（项目结构） |

### 📦 配置文件

```
requirements.txt    # Python依赖列表
.gitignore         # Git忽略文件
```

---

## 🚀 快速开始流程

```
1. 安装依赖
   └─ pip install -r requirements.txt

2. 快速测试 ← 推荐从这里开始
   └─ python quick_test.py (3分钟)
   └─ 查看5只样本股票的交易信号

3. 完整回测 ← 如果满意快速测试的结果
   └─ python main.py (15-30分钟)
   └─ 获得沪深300和中证500的完整回测结果

4. 查看结果
   └─ 用Excel打开生成的.csv文件
   └─ 用图片查看器查看.png文件

5. 调整参数 (可选)
   └─ 修改 config.py
   └─ 重复步骤2-4
```

---

## 📊 数据流向

```
akshare数据源
    ↓
data_fetcher.py (获取指数成分股和历史数据)
    ↓
策略处理
    ├─ strategy.py (计算交易信号)
    ├─ backtest_engine.py (运行回测)
    └─ visualizer.py (生成图表)
    ↓
输出文件
    ├─ .csv (交易记录和汇总)
    ├─ .png (图表)
    └─ 控制台 (实时进度)
```

---

## 🎯 策略逻辑图

```
股票价格数据
    ↓
[条件1] MA30向上?
[条件2] 量能放大? (最近日成交量 > 前20日平均 × 2)
[条件3] 价格回踩5日线? (收盘 < MA5)
    ↓
三个条件都满足 → 买入信号
    ↓
持有3个交易日
    ↓
卖出信号 → 计算收益率
```

---

## 📋 配置参数说明

在 `config.py` 中修改：

```python
START_DATE = "20200101"              # 回测开始日期
END_DATE = "20250213"                # 回测结束日期

INDICES = {
    "沪深300": "000300",             # 沪深300指数代码
    "中证500": "000905",             # 中证500指数代码
}

MAX_STOCKS = 100                     # 每个指数最多回测100只股票

STRATEGY_PARAMS = {
    "ma_period": 30,                 # MA周期（天）
    "recent_days": 5,                # 最近交易日数
    "retest_period": 5,              # 回踩均线周期
    "hold_days": 3,                  # 持有天数
    "volume_multiplier": 2.0,        # 量能放大倍数
}
```

---

## 🔍 回测输出解释

### CSV文件结构

**回测汇总对比.csv**:
```
指数,股票数,交易数,总收益%,平均收益%,胜率%,盈亏比
沪深300,45,132,287.45,2.18,62.1,1.85
中证500,38,98,256.34,2.61,59.4,1.72
```

**详细交易记录_沪深300.csv**:
```
代码,买入日期,买入价,卖出日期,卖出价,持有天数,收益率%,状态
000001,2024-03-15,10.50,2024-03-18,10.55,3,0.38%,平仓
000002,2024-03-20,20.40,2024-03-23,20.65,3,1.22%,平仓
```

### 关键指标解释

| 指标 | 含义 | 范围 |
|------|------|------|
| **总交易数** | 满足条件的交易次数 | 越多越好（有足够交易量） |
| **总收益%** | 所有交易收益之和 | 越高越好 |
| **平均收益%** | 平均每笔交易收益 | 正数为好 |
| **胜率%** | 盈利交易比例 | 50%-70%为合理 |
| **盈亏比** | 平均盈利/平均亏损 | >1.5为好（说明赚大赔小） |

---

## 🛠️ 自定义策略（高级）

要修改策略逻辑，编辑 `strategy.py` 中的 `VolumeBreakoutStrategy` 类：

```python
class VolumeBreakoutStrategy:
    def calculate_signals(self, df: pd.DataFrame) -> pd.DataFrame:
        # 在这里添加你的指标计算
        df['Your_Indicator'] = ...

        # 修改买入条件
        df['Buy_Signal'] = (条件1) & (条件2) & (条件3)

        return df
```

---

## ⚠️ 重要提醒

1. **历史不代表未来** - 回测结果好 ≠ 未来一定盈利
2. **风险管理** - 实盘需要考虑止损、仓位控制等
3. **成本计算** - 回测已包含基本手续费（0.1%），实际可能不同
4. **数据偏差** - 数据来自第三方，可能存在偏差

---

## 🐛 调试技巧

### 查看策略信号
修改 `quick_test.py`，添加打印语句查看详细信号。

### 调整日志输出
在 `main.py` 中添加更多的 `print()` 语句追踪执行过程。

### 单个股票测试
```python
from strategy import VolumeBreakoutStrategy
from data_fetcher import get_stock_data

df = get_stock_data("000001", "20240101", "20250213")
strategy = VolumeBreakoutStrategy(STRATEGY_PARAMS)
signals = strategy.calculate_signals(df)
print(signals[signals['Buy_Signal']])  # 查看所有买入信号
```

---

## 📈 下一步扩展方向

- [ ] 添加止损和止盈条件
- [ ] 支持动态参数优化
- [ ] 实现多策略组合
- [ ] 添加实时行情对接
- [ ] 支持A股科创板/创业板
- [ ] 集成交易接口（实盘交易）
- [ ] 添加风险管理模块

---

## 📞 支持

如有问题：
1. 查看 `QUICKSTART.md`（快速开始）
2. 查看 `USAGE.md`（详细指南）
3. 检查 `README.md`（概念解释）
4. 查看代码中的注释
5. 尝试修改参数重新测试

---

**系统版本**: 1.0
**最后更新**: 2025-02-13
**状态**: ✅ 可用

现在你可以开始了！👉 运行 `python quick_test.py`

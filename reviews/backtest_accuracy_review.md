# å›æµ‹å‡†ç¡®æ€§å®¡æŸ¥æŠ¥å‘Šï¼ˆé‡‘èé¢†åŸŸï¼‰

**å®¡æŸ¥æ—¥æœŸ**: 2026-02-16
**å®¡æŸ¥èŒƒå›´**: è‚¡ç¥¨å›æµ‹ç³»ç»Ÿ - é‡‘èå‡†ç¡®æ€§ä¸“é¡¹å®¡æŸ¥
**ä»£ç è§„æ¨¡**: 8,232 è¡Œä»£ç 
**å®¡æŸ¥é‡ç‚¹**: å‰è§†åå·®ã€æŠ€æœ¯æŒ‡æ ‡è®¡ç®—ã€äº¤æ˜“æˆæœ¬ã€å¸‚åœºé™åˆ¶

---

## âš ï¸ ä¸¥é‡æ€§åˆ†çº§

- **Critical (ä¸¥é‡)**: å¯¼è‡´å›æµ‹ç»“æœå®Œå…¨å¤±çœŸçš„é—®é¢˜ - å¿…é¡»ç«‹å³ä¿®å¤
- **High (é«˜å±)**: ä¸¥é‡å½±å“å›æµ‹å‡†ç¡®æ€§çš„é—®é¢˜ - å¼ºçƒˆå»ºè®®ä¿®å¤
- **Medium (ä¸­å±)**: å½±å“çœŸå®äº¤æ˜“è¡¨ç°çš„é—®é¢˜ - å»ºè®®ä¿®å¤
- **Low (ä½å±)**: ä¼˜åŒ–å»ºè®® - å¯é€‰ä¿®å¤

---

## ğŸ“Š æ‰§è¡Œæ‘˜è¦

| é—®é¢˜çº§åˆ« | æ•°é‡ | å½±å“æè¿° |
|---------|------|---------|
| **Critical** | 6 | å‰è§†åå·®ã€äº¤æ˜“æ—¶æœºé”™è¯¯ã€æœªè€ƒè™‘æ¶¨è·Œåœ |
| **High** | 8 | äº¤æ˜“æˆæœ¬åä½ã€æ»‘ç‚¹ä¸åˆç†ã€æŠ€æœ¯æŒ‡æ ‡è¯¯ç”¨ |
| **Medium** | 5 | å¸‚åœºé™åˆ¶ç¼ºå¤±ã€æ•°æ®ç”Ÿå­˜åå·® |
| **Total** | 19 | ç»¼åˆè¯„ä¼°ï¼šå›æµ‹å¯ä¿¡åº¦ 3.5/10 |

### ğŸ”´ è‡´å‘½ç¼ºé™·ï¼ˆå¿…é¡»ä¿®å¤ï¼‰

1. **å‰è§†åå·®** - å½“æ—¥ä¿¡å·å½“æ—¥ä¹°å…¥ï¼ˆ100%é”™è¯¯ï¼‰
2. **äº¤æ˜“æˆæœ¬** - æ‰‹ç»­è´¹ç‡ä½ä¼°10å€
3. **æ¶¨è·Œåœé™åˆ¶** - å®Œå…¨æœªè€ƒè™‘
4. **T+1åˆ¶åº¦** - æœªå®ç°ï¼ˆAè‚¡æ ¸å¿ƒè§„åˆ™ï¼‰
5. **ä¿¡å·ç”Ÿæˆé€»è¾‘** - ä½¿ç”¨shift(1)é”™è¯¯
6. **å¤åˆ©è®¡ç®—** - å•æ¬¡æ”¶ç›Šç‡æ±‚å’Œï¼ˆé”™è¯¯ï¼‰

---

## 1. å‰è§†åå·®æ£€æŸ¥ â­ æœ€ä¸¥é‡çš„é—®é¢˜

### 1.1 Critical: å½“æ—¥ä¿¡å·å½“æ—¥ä¹°å…¥ï¼ˆå‰è§†åå·®ï¼‰

**ä½ç½®**: `strategy.py` æ‰€æœ‰ç­–ç•¥ç±»çš„ `get_trades()` æ–¹æ³•

**é—®é¢˜æè¿°**:
ç³»ç»Ÿåœ¨æ£€æµ‹åˆ°ä¹°å…¥ä¿¡å·çš„**å½“æ—¥**å°±ä»¥**å½“æ—¥æ”¶ç›˜ä»·**ä¹°å…¥ï¼Œè¿™æ˜¯å…¸å‹çš„å‰è§†åå·®ã€‚åœ¨çœŸå®äº¤æ˜“ä¸­ï¼Œåªèƒ½åœ¨**æ¬¡æ—¥**ä»¥**æ¬¡æ—¥ä»·æ ¼**ä¹°å…¥ã€‚

**é”™è¯¯ä»£ç ç¤ºä¾‹** (`strategy.py` ç¬¬79-84è¡Œ):
```python
for i, row in df_signals.iterrows():
    if row['Buy_Signal'] and buy_date is None:
        buy_date = row['æ—¥æœŸ']
        buy_price = row['æ”¶ç›˜']  # âŒ é”™è¯¯ï¼šä½¿ç”¨å½“æ—¥æ”¶ç›˜ä»·
        buy_idx = i
```

**é—®é¢˜åˆ†æ**:
```
æ—¶é—´è½´ï¼ˆé”™è¯¯é€»è¾‘ï¼‰ï¼š
Day N: æ”¶ç›˜åè®¡ç®—æŒ‡æ ‡ â†’ äº§ç”Ÿä¹°å…¥ä¿¡å· â†’ ä»¥Day Næ”¶ç›˜ä»·ä¹°å…¥ âŒ

çœŸå®äº¤æ˜“æµç¨‹ï¼š
Day N: æ”¶ç›˜åè®¡ç®—æŒ‡æ ‡ â†’ äº§ç”Ÿä¹°å…¥ä¿¡å·
Day N+1: å¼€ç›˜/ç›˜ä¸­ä»¥Day N+1ä»·æ ¼ä¹°å…¥ âœ“
```

**æ­£ç¡®å®ç°**:
```python
# âœ… æ­£ç¡®æ–¹æ³•1ï¼šæ¬¡æ—¥å¼€ç›˜ä»·ä¹°å…¥
for i, row in df_signals.iterrows():
    if i > 0 and df_signals.iloc[i-1]['Buy_Signal'] and buy_date is None:
        buy_date = row['æ—¥æœŸ']
        buy_price = row['å¼€ç›˜']  # æ¬¡æ—¥å¼€ç›˜ä»·

# âœ… æ­£ç¡®æ–¹æ³•2ï¼šæ¬¡æ—¥æ”¶ç›˜ä»·ä¹°å…¥ï¼ˆæ›´ä¿å®ˆï¼‰
for i in range(1, len(df_signals)):
    if df_signals.iloc[i-1]['Buy_Signal'] and buy_date is None:
        buy_date = df_signals.iloc[i]['æ—¥æœŸ']
        buy_price = df_signals.iloc[i]['æ”¶ç›˜']
```

**å½±å“**:
- å›æµ‹æ”¶ç›Šç‡**ä¸¥é‡è™šé«˜**ï¼ˆå¯èƒ½é«˜ä¼°20%-50%ï¼‰
- ä¿¡å·äº§ç”Ÿåä»·æ ¼å¯èƒ½æ¬¡æ—¥è·³ç©ºï¼Œæ— æ³•æˆäº¤
- æ‰€æœ‰äº¤æ˜“çš„ä¹°å–æ—¶æœºéƒ½æå‰1å¤©

**ä¿®å¤ä¼˜å…ˆçº§**: ğŸ”´ P0 - ç«‹å³ä¿®å¤ï¼ˆæ‰€æœ‰ç­–ç•¥éƒ½å­˜åœ¨æ­¤é—®é¢˜ï¼‰

---

### 1.2 Critical: ä¿¡å·è®¡ç®—ä½¿ç”¨shift(1)çš„è¯¯ç”¨

**ä½ç½®**: `strategy.py` å¤šå¤„ï¼ˆç¬¬44è¡Œã€ç¬¬170è¡Œç­‰ï¼‰

**é—®é¢˜æè¿°**:
ä»£ç ä½¿ç”¨ `shift(1)` æ¥æ¯”è¾ƒ"å‰ä¸€å¤©"çš„å€¼ï¼Œä½†åœ¨ä¹°å…¥æ—¶åˆä½¿ç”¨å½“å‰è¡Œçš„æ”¶ç›˜ä»·ï¼Œå¯¼è‡´é€»è¾‘æ··ä¹±ã€‚

**é”™è¯¯ä»£ç ** (`strategy.py` ç¬¬44è¡Œ):
```python
df['MA30_Up'] = df['MA30'] > df['MA30'].shift(1)  # åˆ¤æ–­MA30å‘ä¸Š
```

**é—®é¢˜**:
```python
# ç¬¬iè¡Œçš„MA30_Up = Trueï¼Œè¡¨ç¤ºï¼š
# df.iloc[i]['MA30'] > df.iloc[i-1]['MA30']
# æ„æ€æ˜¯ï¼šç¬¬iå¤©çš„MA30 > ç¬¬i-1å¤©çš„MA30

# ä½†ä¹°å…¥é€»è¾‘æ˜¯ï¼š
if row['Buy_Signal']:  # ç¬¬iè¡Œä¸ºTrue
    buy_price = row['æ”¶ç›˜']  # âŒ ä½¿ç”¨ç¬¬iå¤©æ”¶ç›˜ä»·ä¹°å…¥

# æ­£ç¡®åº”è¯¥æ˜¯ï¼š
# ç¬¬iå¤©ä¿¡å·è§¦å‘ â†’ ç¬¬i+1å¤©ä¹°å…¥
```

**æ­£ç¡®é€»è¾‘**:
```python
# æ–¹æ¡ˆA: ä¿¡å·ä¸shiftï¼Œä¹°å…¥shift
df['MA30_Up'] = df['MA30'] > df['MA30'].shift(1)
df['Buy_Signal'] = ...
# ä¹°å…¥æ—¶ä½¿ç”¨ i+1 è¡Œçš„ä»·æ ¼

# æ–¹æ¡ˆB: ä¿¡å·shiftï¼Œä¹°å…¥ä¸shift
df['Buy_Signal_Prev'] = df['Buy_Signal'].shift(1)
# ä¹°å…¥æ—¶ç›´æ¥ä½¿ç”¨å½“å‰è¡Œä»·æ ¼
```

**å½±å“**: æ‰€æœ‰ç­–ç•¥çš„ä¹°å…¥æ—¶æœºéƒ½æå‰1å¤©

**ä¿®å¤ä¼˜å…ˆçº§**: ğŸ”´ P0 - ç«‹å³ä¿®å¤

---

### 1.3 Critical: æŠ€æœ¯æŒ‡æ ‡è®¡ç®—çš„å‰è§†é£é™©

**ä½ç½®**: `strategy.py` ç¬¬296è¡Œï¼ˆAggressiveMomentumStrategyï¼‰

**é—®é¢˜ä»£ç **:
```python
# çªç ´æ¡ä»¶
high_n = df['é«˜'].rolling(window=self.breakout_period).max().shift(1)
breakout = df['æ”¶ç›˜'] > high_n * (1 + self.breakout_threshold)
```

**åˆ†æ**:
- `shift(1)` ä¿è¯äº†ä¸ä½¿ç”¨å½“æ—¥æœ€é«˜ä»·ï¼ˆâœ“ æ­£ç¡®ï¼‰
- ä½†ä¹°å…¥ä»ä½¿ç”¨å½“æ—¥æ”¶ç›˜ä»·ï¼ˆâŒ é”™è¯¯ï¼‰

**æ­£ç¡®å®ç°**:
```python
# è®¡ç®—å‰20æ—¥æœ€é«˜ä»·ï¼ˆä¸åŒ…æ‹¬ä»Šæ—¥ï¼‰
high_n = df['é«˜'].rolling(window=20).max().shift(1)

# çªç ´ä¿¡å·ç”Ÿæˆ
df['Breakout_Signal'] = df['æ”¶ç›˜'] > high_n * 1.03

# æ¬¡æ—¥ä¹°å…¥
for i in range(1, len(df)):
    if df.iloc[i-1]['Breakout_Signal']:
        buy_price = df.iloc[i]['å¼€ç›˜']  # æ¬¡æ—¥å¼€ç›˜ä»·
```

**ä¿®å¤ä¼˜å…ˆçº§**: ğŸ”´ P0 - Critical

---

### 1.4 High: å–å‡ºä¿¡å·çš„å‰è§†åå·®

**ä½ç½®**: `strategy.py` ç¬¬85-88è¡Œ

**é—®é¢˜ä»£ç **:
```python
if row['Sell_Signal'] and buy_date is not None:
    sell_date = row['æ—¥æœŸ']
    sell_price = row['æ”¶ç›˜']  # âŒ å½“æ—¥å–å‡º
```

**é—®é¢˜**:
- Aè‚¡æ˜¯T+1åˆ¶åº¦ï¼Œ**ä»Šæ—¥ä¹°å…¥çš„è‚¡ç¥¨ä¸èƒ½å½“æ—¥å–å‡º**
- å³ä½¿æ˜¯æŒä»“è‚¡ç¥¨ï¼Œå–å‡ºä¿¡å·ä¹Ÿåº”è¯¥æ¬¡æ—¥æ‰§è¡Œ

**æ­£ç¡®å®ç°**:
```python
# æ£€æŸ¥å‰ä¸€æ—¥æ˜¯å¦æœ‰å–å‡ºä¿¡å·
if i > buy_idx + 1:  # ç¡®ä¿æŒä»“è‡³å°‘1å¤©ï¼ˆT+1ï¼‰
    if df.iloc[i-1]['Sell_Signal']:
        sell_date = row['æ—¥æœŸ']
        sell_price = row['å¼€ç›˜']  # æ¬¡æ—¥å¼€ç›˜ä»·å–å‡º
```

**ä¿®å¤ä¼˜å…ˆçº§**: ğŸ”´ P0 - Critical

---

### 1.5 Critical: æ­¢æŸæ­¢ç›ˆçš„å³æ—¶åˆ¤æ–­é—®é¢˜

**ä½ç½®**: `strategy.py` ç¬¬213-223è¡Œï¼ˆSteadyTrendStrategyï¼‰

**é—®é¢˜ä»£ç **:
```python
current_price = row['æ”¶ç›˜']
profit_pct = (current_price - entry_price) / entry_price

# æ­¢æŸ
if profit_pct <= -self.stop_loss:
    sell_reason = 'æ­¢æŸ'
```

**é—®é¢˜**:
- ä½¿ç”¨å½“æ—¥æ”¶ç›˜ä»·åˆ¤æ–­æ­¢æŸï¼Œå¹¶ä»¥å½“æ—¥æ”¶ç›˜ä»·å–å‡º
- çœŸå®æƒ…å†µï¼šæ”¶ç›˜åæ‰çŸ¥é“æ”¶ç›˜ä»·ï¼Œæ— æ³•ä»¥æ”¶ç›˜ä»·å–å‡º

**æ­£ç¡®å®ç°**:
```python
# æ–¹æ¡ˆA: ä½¿ç”¨å‰ä¸€æ—¥æ”¶ç›˜ä»·åˆ¤æ–­ï¼Œæ¬¡æ—¥å¼€ç›˜å–å‡º
if i > 0:
    prev_price = df.iloc[i-1]['æ”¶ç›˜']
    profit_pct = (prev_price - entry_price) / entry_price
    if profit_pct <= -0.08:
        sell_price = row['å¼€ç›˜']  # æ¬¡æ—¥å¼€ç›˜æ­¢æŸ

# æ–¹æ¡ˆB: ä½¿ç”¨ç›˜ä¸­ä»·æ ¼ï¼ˆéœ€è¦åˆ†é’Ÿæ•°æ®ï¼‰
# æ£€æŸ¥æ˜¯å¦è§¦åŠæ­¢æŸçº¿ï¼Œä»¥è§¦å‘æ—¶åˆ»ä»·æ ¼å–å‡º
```

**å½±å“**: æ­¢æŸæ­¢ç›ˆçš„å‡†ç¡®æ€§ä¸¥é‡å¤±çœŸ

**ä¿®å¤ä¼˜å…ˆçº§**: ğŸ”´ P0 - Critical

---

## 2. æŠ€æœ¯æŒ‡æ ‡è®¡ç®—éªŒè¯

### 2.1 High: MACDè®¡ç®— - ä¸é€šè¾¾ä¿¡æ ‡å‡†ä¸ä¸€è‡´

**ä½ç½®**: `indicators.py` ç¬¬19-30è¡Œ

**å½“å‰å®ç°**:
```python
def calculate_macd(df, fast=12, slow=26, signal=9):
    ema_fast = calculate_ema(df, fast)
    ema_slow = calculate_ema(df, slow)
    dif = ema_fast - ema_slow
    dea = dif.ewm(span=signal, adjust=False).mean()
    hist = dif - dea
    return {'DIF': dif, 'DEA': dea, 'HIST': hist}
```

**é€šè¾¾ä¿¡æ ‡å‡†ç®—æ³•**:
```python
# é€šè¾¾ä¿¡MACDæ ‡å‡†ç®—æ³•
DIF = EMA(CLOSE, 12) - EMA(CLOSE, 26)
DEA = EMA(DIF, 9)
MACD = (DIF - DEA) * 2  # âš ï¸ æ³¨æ„ï¼šæŸ±çŠ¶å›¾æ˜¯å·®å€¼çš„2å€
```

**å¯¹æ¯”**:
| é¡¹ç›® | å½“å‰å®ç° | é€šè¾¾ä¿¡æ ‡å‡† | å·®å¼‚ |
|------|---------|-----------|------|
| DIF | âœ“ æ­£ç¡® | EMA(12)-EMA(26) | æ—  |
| DEA | âœ“ æ­£ç¡® | EMA(DIF,9) | æ—  |
| HIST | `DIF-DEA` | `(DIF-DEA)*2` | âŒ å·®2å€ |

**å½±å“**:
- MACDæŸ±çŠ¶å›¾æ•°å€¼åå°50%
- å½±å“åŸºäºMACDæŸ±çŠ¶å›¾çš„äº¤æ˜“ä¿¡å·
- SteadyTrendStrategyã€BalancedMultiFactorStrategyå—å½±å“

**ä¿®å¤å»ºè®®**:
```python
def calculate_macd(df, fast=12, slow=26, signal=9):
    ema_fast = calculate_ema(df, fast)
    ema_slow = calculate_ema(df, slow)
    dif = ema_fast - ema_slow
    dea = dif.ewm(span=signal, adjust=False).mean()
    hist = (dif - dea) * 2  # âœ… ä¿®å¤ï¼šä¹˜ä»¥2
    return {'DIF': dif, 'DEA': dea, 'HIST': hist}
```

**ä¿®å¤ä¼˜å…ˆçº§**: ğŸŸ  P1 - High

---

### 2.2 Medium: RSIè®¡ç®— - å¹³æ»‘æ–¹æ³•å·®å¼‚

**ä½ç½®**: `indicators.py` ç¬¬33-43è¡Œ

**å½“å‰å®ç°**:
```python
def calculate_rsi(df, period=14):
    delta = df[column].diff()
    gain = (delta.where(delta > 0, 0)).rolling(window=period).mean()
    loss = (-delta.where(delta < 0, 0)).rolling(window=period).mean()
    rs = gain / loss
    rsi = 100 - (100 / (1 + rs))
    return rsi
```

**é—®é¢˜**: ä½¿ç”¨ç®€å•ç§»åŠ¨å¹³å‡ï¼ˆSMAï¼‰ï¼Œè€Œæ ‡å‡†RSIä½¿ç”¨æŒ‡æ•°ç§»åŠ¨å¹³å‡ï¼ˆEMAï¼‰

**Wilderæ ‡å‡†ç®—æ³•**:
```python
def calculate_rsi_wilder(df, period=14):
    delta = df['æ”¶ç›˜'].diff()
    gain = delta.where(delta > 0, 0)
    loss = -delta.where(delta < 0, 0)

    # ä½¿ç”¨æŒ‡æ•°å¹³æ»‘ï¼ˆWilderæ–¹æ³•ï¼‰
    avg_gain = gain.ewm(alpha=1/period, adjust=False).mean()
    avg_loss = loss.ewm(alpha=1/period, adjust=False).mean()

    rs = avg_gain / avg_loss
    rsi = 100 - (100 / (1 + rs))
    return rsi
```

**å·®å¼‚å½±å“**:
- SMAæ–¹æ³•ï¼šRSIæ³¢åŠ¨æ›´å¤§ï¼Œæ»åæ€§æ›´å¼º
- EMAæ–¹æ³•ï¼ˆæ ‡å‡†ï¼‰ï¼šæ›´å¹³æ»‘ï¼Œæ›´æ¥è¿‘å¸‚åœºå…±è¯†
- å·®å¼‚èŒƒå›´ï¼šRSIå€¼ç›¸å·®Â±5å·¦å³

**ä¿®å¤ä¼˜å…ˆçº§**: ğŸŸ¡ P2 - Medium

---

### 2.3 High: KDJè®¡ç®— - RSVè¾¹ç•Œå¤„ç†

**ä½ç½®**: `indicators.py` ç¬¬46-62è¡Œ

**é—®é¢˜ä»£ç **:
```python
rsv = (df['æ”¶ç›˜'] - low_list) / (high_list - low_list) * 100
rsv = rsv.fillna(50)  # âŒ é—®é¢˜ï¼šå½“high=lowæ—¶ï¼Œé™¤é›¶åå¡«å……50
```

**é—®é¢˜åˆ†æ**:
```python
# å½“9æ—¥å†…æœ€é«˜ä»·=æœ€ä½ä»·æ—¶ï¼ˆä¸€å­—æ¿ã€åœç‰Œï¼‰
# RSV = (close - low) / (high - low) * 100
# = (close - low) / 0 â†’ inf â†’ NaN â†’ 50

# é—®é¢˜ï¼š
# 1. ä¸€å­—æ¶¨åœæ¿ï¼ˆclose=high=lowï¼‰åº”è¯¥RSV=100
# 2. ä¸€å­—è·Œåœæ¿ï¼ˆclose=high=lowï¼‰åº”è¯¥RSV=0
# 3. ç»Ÿä¸€å¡«å……50ä¼šå¯¼è‡´ä¿¡å·é”™è¯¯
```

**æ­£ç¡®å®ç°**:
```python
low_list = df['ä½'].rolling(window=n).min()
high_list = df['é«˜'].rolling(window=n).max()

# è®¡ç®—RSV
range_hl = high_list - low_list
rsv = pd.Series(index=df.index, dtype=float)

# åˆ†æƒ…å†µå¤„ç†
rsv = np.where(
    range_hl > 0,
    (df['æ”¶ç›˜'] - low_list) / range_hl * 100,
    50  # æˆ–è€…ç»§æ‰¿å‰ä¸€æ—¥RSV
)
rsv = pd.Series(rsv, index=df.index)
```

**å½±å“**: æ¶¨è·Œåœã€åœç‰ŒæœŸé—´çš„KDJä¿¡å·é”™è¯¯

**ä¿®å¤ä¼˜å…ˆçº§**: ğŸŸ  P1 - High

---

### 2.4 Medium: å¸ƒæ—å¸¦è®¡ç®— - æ ‡å‡†å·®ä½¿ç”¨

**ä½ç½®**: `indicators.py` ç¬¬65-76è¡Œ

**å½“å‰å®ç°** (âœ“ æ­£ç¡®):
```python
def calculate_bollinger_bands(df, period=20, std_mult=2.0):
    middle = calculate_ma(df, period)
    std = df[column].rolling(window=period).std()
    upper = middle + (std * std_mult)
    lower = middle - (std * std_mult)
    return {'UPPER': upper, 'MIDDLE': middle, 'LOWER': lower}
```

**éªŒè¯**: ä¸é€šè¾¾ä¿¡æ ‡å‡†ä¸€è‡´ âœ“

**æ³¨æ„äº‹é¡¹**:
- `rolling().std()` é»˜è®¤ä½¿ç”¨æ ·æœ¬æ ‡å‡†å·®ï¼ˆddof=1ï¼‰
- é€šè¾¾ä¿¡ä¹Ÿä½¿ç”¨æ ·æœ¬æ ‡å‡†å·®
- å¦‚éœ€æ€»ä½“æ ‡å‡†å·®ï¼Œä½¿ç”¨ `std(ddof=0)`

**ä¿®å¤ä¼˜å…ˆçº§**: âœ“ æ— éœ€ä¿®å¤

---

### 2.5 High: ATRè®¡ç®— - é¦–æ—¥TRé—®é¢˜

**ä½ç½®**: `indicators.py` ç¬¬79-89è¡Œ

**é—®é¢˜ä»£ç **:
```python
def calculate_atr(df, period=14):
    high_low = df['é«˜'] - df['ä½']
    high_close = np.abs(df['é«˜'] - df['æ”¶ç›˜'].shift(1))  # âš ï¸ é¦–æ—¥æ— shift(1)
    low_close = np.abs(df['ä½'] - df['æ”¶ç›˜'].shift(1))

    tr = pd.concat([high_low, high_close, low_close], axis=1).max(axis=1)
    atr = tr.rolling(window=period).mean()
    return atr
```

**é—®é¢˜**: ç¬¬ä¸€è¡Œæ•°æ®çš„ `shift(1)` ä¸ºNaNï¼Œå¯¼è‡´TRè®¡ç®—é”™è¯¯

**æ­£ç¡®å®ç°**:
```python
def calculate_atr(df, period=14):
    high_low = df['é«˜'] - df['ä½']
    high_close = np.abs(df['é«˜'] - df['æ”¶ç›˜'].shift(1))
    low_close = np.abs(df['ä½'] - df['æ”¶ç›˜'].shift(1))

    # é¦–æ—¥TR = high - low
    tr = pd.concat([high_low, high_close, low_close], axis=1).max(axis=1)
    tr.iloc[0] = df.iloc[0]['é«˜'] - df.iloc[0]['ä½']  # âœ… ä¿®å¤é¦–æ—¥

    # ä½¿ç”¨Wilderå¹³æ»‘æ³•ï¼ˆæ›´å‡†ç¡®ï¼‰
    atr = tr.ewm(alpha=1/period, adjust=False).mean()
    return atr
```

**å½±å“**: é¦–æ—¥ATRå€¼é”™è¯¯ï¼Œå½±å“åç»­14å¤©çš„ATR

**ä¿®å¤ä¼˜å…ˆçº§**: ğŸŸ  P1 - High

---

## 3. äº¤æ˜“æˆæœ¬å’Œç°å®å› ç´ 

### 3.1 Critical: æ‰‹ç»­è´¹ç‡ä¸¥é‡åä½

**ä½ç½®**: `config.py` ç¬¬179è¡Œã€`strategy.py` ç¬¬91è¡Œ

**å½“å‰è®¾ç½®**:
```python
# config.py
COMMISSION_RATE = 0.00002  # ä¸‡åˆ†ä¹‹2ï¼ˆ0.002%ï¼‰

# strategy.py
profit_pct_after_fee = profit_pct - 0.1  # å¾€è¿”0.1%
```

**é—®é¢˜**: äº¤æ˜“æˆæœ¬è®¡ç®—**ä¸¥é‡ä½ä¼°**

**çœŸå®Aè‚¡äº¤æ˜“æˆæœ¬**:
| è´¹ç”¨ç±»å‹ | è´¹ç‡ | è¯´æ˜ |
|---------|------|------|
| åˆ¸å•†ä½£é‡‘ï¼ˆä¹°å…¥ï¼‰ | 0.02% - 0.03% | ä¸‡2-ä¸‡3ï¼Œæœ€ä½5å…ƒ |
| åˆ¸å•†ä½£é‡‘ï¼ˆå–å‡ºï¼‰ | 0.02% - 0.03% | ä¸‡2-ä¸‡3ï¼Œæœ€ä½5å…ƒ |
| å°èŠ±ç¨ï¼ˆå–å‡ºï¼‰ | 0.1% | åƒåˆ†ä¹‹ä¸€ï¼ˆå•å‘æ”¶å–ï¼‰|
| è¿‡æˆ·è´¹ï¼ˆåŒå‘ï¼‰ | 0.001% | ä¸‡0.1ï¼ˆæ²ªå¸‚è‚¡ç¥¨ï¼‰|
| **å•æ¬¡å¾€è¿”æ€»æˆæœ¬** | **â‰ˆ0.15%-0.16%** | å«æ‰€æœ‰è´¹ç”¨ |

**ä»£ç é—®é¢˜åˆ†æ**:
```python
# é—®é¢˜1: config.pyä¸­çš„COMMISSION_RATEæœªè¢«ä½¿ç”¨
COMMISSION_RATE = 0.00002  # backtest_engine.pyä¸­æœªä½¿ç”¨æ­¤å‚æ•°

# é—®é¢˜2: strategy.pyä¸­ç¡¬ç¼–ç 0.1%
profit_pct_after_fee = profit_pct - 0.1  # åªè€ƒè™‘ä½£é‡‘+å°èŠ±ç¨

# é—®é¢˜3: æœªè€ƒè™‘è¿‡æˆ·è´¹
# é—®é¢˜4: æœªè€ƒè™‘æœ€ä½5å…ƒä½£é‡‘
```

**æ­£ç¡®å®ç°**:
```python
def calculate_commission(buy_price, sell_price, volume):
    """è®¡ç®—å®Œæ•´äº¤æ˜“æˆæœ¬ï¼ˆAè‚¡ï¼‰"""
    buy_amount = buy_price * volume
    sell_amount = sell_price * volume

    # ä¹°å…¥ä½£é‡‘ï¼ˆä¸‡2.5ï¼Œæœ€ä½5å…ƒï¼‰
    buy_commission = max(buy_amount * 0.00025, 5)

    # å–å‡ºä½£é‡‘ï¼ˆä¸‡2.5ï¼Œæœ€ä½5å…ƒï¼‰
    sell_commission = max(sell_amount * 0.00025, 5)

    # å°èŠ±ç¨ï¼ˆåƒ1ï¼Œä»…å–å‡ºï¼‰
    stamp_duty = sell_amount * 0.001

    # è¿‡æˆ·è´¹ï¼ˆä¸‡0.1ï¼ŒåŒå‘ï¼‰
    transfer_fee = (buy_amount + sell_amount) * 0.00001

    total_cost = buy_commission + sell_commission + stamp_duty + transfer_fee
    cost_rate = total_cost / buy_amount * 100  # ç™¾åˆ†æ¯”

    return cost_rate

# ç¤ºä¾‹ï¼šä¹°å…¥10000å…ƒï¼ŒæŒæœ‰3å¤©åå–å‡º10500å…ƒ
buy_price = 10.0
sell_price = 10.5
volume = 1000  # è‚¡
cost = calculate_commission(buy_price, sell_price, volume)
# ç»“æœï¼šçº¦0.16%
```

**å½±å“**:
- å›æµ‹æ”¶ç›Šç‡**è™šé«˜0.05%-0.06%** æ¯ç¬”äº¤æ˜“
- å¯¹äºé«˜é¢‘ç­–ç•¥å½±å“æ›´å¤§ï¼ˆå¹´åŒ–å¯èƒ½è™šé«˜10%-20%ï¼‰
- å°èµ„é‡‘è´¦æˆ·å½±å“æ›´ä¸¥é‡ï¼ˆæœ€ä½5å…ƒä½£é‡‘ï¼‰

**ä¿®å¤å»ºè®®**:
```python
# strategy.py ä¿®å¤
profit_pct_after_fee = profit_pct - 0.16  # âœ… å¾€è¿”0.16%

# æˆ–è€…æ›´å‡†ç¡®çš„å®ç°
commission_rate = 0.00025  # ä¸‡2.5
stamp_duty_rate = 0.001    # åƒ1
transfer_fee_rate = 0.00001  # ä¸‡0.1

total_cost_rate = (
    commission_rate * 2 +  # ä¹°å–ä½£é‡‘
    stamp_duty_rate +       # å°èŠ±ç¨
    transfer_fee_rate * 2   # è¿‡æˆ·è´¹
) * 100  # è½¬ç™¾åˆ†æ¯”
# = 0.1622%

profit_pct_after_fee = profit_pct - total_cost_rate
```

**ä¿®å¤ä¼˜å…ˆçº§**: ğŸ”´ P0 - Critical

---

### 3.2 High: æ»‘ç‚¹è®¾ç½®ä¸åˆç†

**ä½ç½®**: `config.py` ç¬¬180è¡Œ

**å½“å‰è®¾ç½®**:
```python
SLIPPAGE = 0.0002  # æ»‘ç‚¹ 0.02%
```

**é—®é¢˜**: æ»‘ç‚¹ç‡åä½ï¼Œä¸Aè‚¡å¸‚åœºçœŸå®æƒ…å†µä¸ç¬¦

**Aè‚¡çœŸå®æ»‘ç‚¹æƒ…å†µ**:
| æµåŠ¨æ€§ | å¸‚å€¼ | æ»‘ç‚¹èŒƒå›´ | è¯´æ˜ |
|-------|------|---------|------|
| æå¥½ | >500äº¿ | 0.05%-0.1% | æ²ªæ·±300æˆåˆ†è‚¡ |
| è‰¯å¥½ | 100-500äº¿ | 0.1%-0.2% | ä¸­è¯500æˆåˆ†è‚¡ |
| ä¸€èˆ¬ | 50-100äº¿ | 0.2%-0.3% | å°ç›˜è‚¡ |
| è¾ƒå·® | <50äº¿ | 0.3%-0.5% | å°ç›˜è‚¡ã€STè‚¡ |

**å½±å“å› ç´ **:
- äº¤æ˜“æ—¶æ®µï¼šé›†åˆç«ä»· < å¼€ç›˜10åˆ†é’Ÿ < å°¾ç›˜
- æˆäº¤é‡ï¼šæ”¾é‡æ—¶æ»‘ç‚¹å°ï¼Œç¼©é‡æ—¶æ»‘ç‚¹å¤§
- æ¶¨è·Œåœï¼šæ¥è¿‘æ¶¨è·Œåœæ—¶æ»‘ç‚¹æå¤§
- è®¢å•å¤§å°ï¼šå¤§å•æ»‘ç‚¹æ›´ä¸¥é‡

**å»ºè®®è®¾ç½®**:
```python
# æŒ‰å¸‚å€¼åˆ†ç±»è®¾ç½®æ»‘ç‚¹
SLIPPAGE_CONFIG = {
    'large_cap': 0.001,    # 0.1% - å¤§ç›˜è‚¡
    'mid_cap': 0.002,      # 0.2% - ä¸­ç›˜è‚¡
    'small_cap': 0.003,    # 0.3% - å°ç›˜è‚¡
}

# æˆ–è€…ç»Ÿä¸€ä½¿ç”¨ä¸­ç­‰æ°´å¹³
SLIPPAGE = 0.002  # 0.2%ï¼ˆæ¨èï¼‰
```

**ä¿®å¤ä¼˜å…ˆçº§**: ğŸŸ  P1 - High

---

### 3.3 Critical: æ¶¨è·Œåœé™åˆ¶å®Œå…¨æœªè€ƒè™‘

**ä½ç½®**: æ‰€æœ‰ç­–ç•¥çš„ä¹°å–é€»è¾‘

**é—®é¢˜**: ç³»ç»Ÿå‡è®¾æ‰€æœ‰ä»·æ ¼éƒ½å¯ä»¥æˆäº¤ï¼Œ**å®Œå…¨æœªè€ƒè™‘æ¶¨è·Œåœ**

**Aè‚¡æ¶¨è·Œåœè§„åˆ™**:
| æ¿å— | æ¶¨è·Œåœå¹…åº¦ | è¯´æ˜ |
|------|-----------|------|
| ä¸»æ¿ï¼ˆSTï¼‰ | Â±5% | STã€*STè‚¡ç¥¨ |
| ä¸»æ¿ï¼ˆéSTï¼‰ | Â±10% | æ™®é€šè‚¡ç¥¨ |
| åˆ›ä¸šæ¿/ç§‘åˆ›æ¿ | Â±20% | æ³¨å†Œåˆ¶è‚¡ç¥¨ |
| æ–°è‚¡é¦–æ—¥ | æ— é™åˆ¶ | ä¸Šå¸‚é¦–æ—¥ |

**å½±å“åœºæ™¯**:
```python
# åœºæ™¯1: æ¶¨åœæ¿ä¹°å…¥å¤±è´¥
Day 1: äº§ç”Ÿä¹°å…¥ä¿¡å·
Day 2: è‚¡ç¥¨ä¸€å­—æ¶¨åœï¼ˆæ— æ³•ä¹°å…¥ï¼‰âŒ
ç­–ç•¥å‡è®¾ï¼šä»¥æ¶¨åœä»·ä¹°å…¥ âŒ

# åœºæ™¯2: è·Œåœæ¿å–å‡ºå¤±è´¥
Day 1: æŒä»“è‚¡ç¥¨è§¦å‘æ­¢æŸ
Day 2: è‚¡ç¥¨è·Œåœï¼ˆæ— æ³•å–å‡ºï¼‰âŒ
ç­–ç•¥å‡è®¾ï¼šä»¥è·Œåœä»·å–å‡º âŒ
```

**æ­£ç¡®å®ç°**:
```python
def check_limit_price(row):
    """æ£€æŸ¥æ˜¯å¦æ¶¨è·Œåœ"""
    prev_close = row['prev_close']
    current_close = row['æ”¶ç›˜']
    change_pct = (current_close - prev_close) / prev_close

    # ä¸»æ¿è‚¡ç¥¨
    if row['board'] == 'main':
        if change_pct >= 0.095:  # æ¥è¿‘+10%è§†ä¸ºæ¶¨åœ
            return 'limit_up'
        elif change_pct <= -0.095:
            return 'limit_down'

    # åˆ›ä¸šæ¿/ç§‘åˆ›æ¿
    elif row['board'] in ['cyb', 'kcb']:
        if change_pct >= 0.195:  # æ¥è¿‘+20%
            return 'limit_up'
        elif change_pct <= -0.195:
            return 'limit_down'

    return 'normal'

# ä¹°å…¥é€»è¾‘ä¿®æ­£
if buy_signal and limit_status != 'limit_up':
    buy_price = row['å¼€ç›˜']  # ä»…åœ¨éæ¶¨åœæ—¶ä¹°å…¥
else:
    # æ¶¨åœæ— æ³•ä¹°å…¥ï¼Œè·³è¿‡æ­¤ä¿¡å·
    pass
```

**ç»Ÿè®¡å½±å“**:
- Aè‚¡å¹³å‡æ¯å¤©çº¦**3%-5%**çš„è‚¡ç¥¨æ¶¨è·Œåœ
- å¯¹äºè¿½æ¶¨ç­–ç•¥ï¼Œå½±å“å¯èƒ½è¾¾åˆ°**20%-30%**çš„ä¿¡å·
- å¯¹äºæ­¢æŸç­–ç•¥ï¼Œå¯èƒ½æ‰©å¤§å®é™…äºæŸ

**ä¿®å¤ä¼˜å…ˆçº§**: ğŸ”´ P0 - Critical

---

### 3.4 Critical: T+1åˆ¶åº¦æœªå®ç°

**ä½ç½®**: æ‰€æœ‰ç­–ç•¥çš„ä¹°å–é€»è¾‘

**é—®é¢˜**: ç­–ç•¥å…è®¸å½“æ—¥ä¹°å…¥åå½“æ—¥å–å‡ºï¼Œè¿åAè‚¡T+1è§„åˆ™

**Aè‚¡T+1è§„åˆ™**:
- å½“æ—¥ä¹°å…¥çš„è‚¡ç¥¨ï¼Œ**å¿…é¡»ä¸‹ä¸€äº¤æ˜“æ—¥**æ‰èƒ½å–å‡º
- å¯ä»¥å½“æ—¥å¤šæ¬¡ä¹°å…¥ï¼Œä½†éƒ½è®¡å…¥æŒä»“
- å¯è½¬å€ºã€ETFç­‰å“ç§å®è¡ŒT+0ï¼ˆæœ¬ç³»ç»Ÿä¸æ¶‰åŠï¼‰

**é”™è¯¯åœºæ™¯**:
```python
# VolumeBreakoutStrategy æŒæœ‰3å¤©
Day 1: ä¹°å…¥ä¿¡å· â†’ ä¹°å…¥
Day 2: ï¼ˆæŒæœ‰ï¼‰
Day 3: ï¼ˆæŒæœ‰ï¼‰
Day 4: å–å‡ºï¼ˆæŒæœ‰å¤©æ•°=3ï¼‰âœ“ æ­£ç¡®

# SteadyTrendStrategy å¿«é€Ÿæ­¢æŸ
Day 1: ä¹°å…¥ä¿¡å· â†’ ä¹°å…¥
Day 1: æ”¶ç›˜è·Œç ´æ­¢æŸ â†’ å–å‡º âŒ é”™è¯¯ï¼ˆT+1ï¼‰
```

**æ£€æŸ¥ä»£ç ** (`strategy.py` ç¬¬63-66è¡Œ):
```python
for i in range(len(df)):
    if df.loc[i, 'Buy_Signal']:
        if i + self.hold_days < len(df):
            df.loc[i + self.hold_days, 'Sell_Signal'] = True
```
è¿™ä¸ªé€»è¾‘**æ­£ç¡®**ï¼Œå› ä¸º `i + hold_days` ä¿è¯äº†è‡³å°‘æŒæœ‰Nå¤©ã€‚

ä½†æ˜¯ `SteadyTrendStrategy` ä¸­çš„æ­¢æŸé€»è¾‘**æœ‰é—®é¢˜** (ç¬¬213-232è¡Œ):
```python
for i in range(len(df_signals)):
    row = df_signals.iloc[i]

    if row['Buy_Signal'] and position is None:
        position = {'buy_date': row['æ—¥æœŸ'], ...}
        continue  # âœ“ æ­£ç¡®ï¼šä¹°å…¥åcontinue

    if position is not None:
        # âŒ é—®é¢˜ï¼šå¯èƒ½åœ¨ä¹°å…¥å½“æ—¥å°±æ­¢æŸ
        if profit_pct <= -self.stop_loss:
            sell_reason = 'æ­¢æŸ'
```

**ä¿®å¤æ–¹æ¡ˆ**:
```python
if position is not None:
    hold_days = (row['æ—¥æœŸ'] - position['buy_date']).days

    # âœ… å¼ºåˆ¶T+1ï¼šæŒä»“è‡³å°‘1å¤©
    if hold_days < 1:
        continue

    # æ­¢æŸé€»è¾‘
    if profit_pct <= -self.stop_loss:
        sell_reason = 'æ­¢æŸ'
```

**ä¿®å¤ä¼˜å…ˆçº§**: ğŸ”´ P0 - Critical

---

### 3.5 High: æœ€å°äº¤æ˜“å•ä½æœªéªŒè¯

**ä½ç½®**: å›æµ‹å¼•æ“çš„ä¹°å–é€»è¾‘

**é—®é¢˜**: æœªæ£€æŸ¥æœ€å°äº¤æ˜“å•ä½ï¼ˆ100è‚¡ï¼‰

**Aè‚¡äº¤æ˜“è§„åˆ™**:
- ä¹°å…¥ï¼šå¿…é¡»æ˜¯**100è‚¡çš„æ•´æ•°å€**ï¼ˆ1æ‰‹=100è‚¡ï¼‰
- å–å‡ºï¼šå¯ä»¥ä¸è¶³100è‚¡ï¼ˆæ¸…ä»“é›¶è‚¡ï¼‰
- æœ€ä½ä¹°å…¥é‡ï¼š100è‚¡

**å½±å“**:
```python
# å‡è®¾è´¦æˆ·æœ‰10000å…ƒï¼Œè‚¡ä»·98å…ƒ
shares = 10000 / 98 = 102.04è‚¡
# âŒ é”™è¯¯ï¼šæ— æ³•ä¹°å…¥102.04è‚¡
# âœ“ æ­£ç¡®ï¼šåªèƒ½ä¹°å…¥100è‚¡ï¼ˆ1æ‰‹ï¼‰
```

**ä¿®å¤å»ºè®®**:
```python
def calculate_buy_volume(capital, price):
    """è®¡ç®—å¯ä¹°å…¥è‚¡æ•°"""
    shares = int(capital / price / 100) * 100  # å‘ä¸‹å–æ•´åˆ°100çš„å€æ•°
    return shares

# ä¹°å…¥é€»è¾‘
buy_volume = calculate_buy_volume(available_capital, buy_price)
if buy_volume < 100:
    # èµ„é‡‘ä¸è¶³ï¼Œæ— æ³•ä¹°å…¥
    return None
```

**ä¿®å¤ä¼˜å…ˆçº§**: ğŸŸ  P1 - High

---

## 4. å¸‚åœºé™åˆ¶æ£€æŸ¥

### 4.1 High: åœç‰Œè‚¡ç¥¨æœªå¤„ç†

**é—®é¢˜**: ç³»ç»Ÿæœªæ£€æŸ¥åœç‰ŒçŠ¶æ€

**å½±å“**:
- åœç‰ŒæœŸé—´æ— æ³•ä¹°å–
- å¤ç‰Œåå¯èƒ½è·³ç©ºé«˜å¼€/ä½å¼€
- é•¿æœŸåœç‰Œï¼ˆé‡ç»„ï¼‰å¯èƒ½æ•°æœˆæ— æ³•äº¤æ˜“

**å»ºè®®**:
```python
# åœç‰Œæ£€æµ‹
def is_suspended(row):
    return row['æˆäº¤é‡'] == 0 and row['æˆäº¤é¢'] == 0

# ä¹°å…¥æ—¶æ£€æŸ¥
if is_suspended(row):
    # åœç‰Œï¼Œæ— æ³•ä¹°å…¥
    pass
```

**ä¿®å¤ä¼˜å…ˆçº§**: ğŸŸ  P1 - High

---

### 4.2 Medium: é›†åˆç«ä»·è§„åˆ™æœªè€ƒè™‘

**é—®é¢˜**: å›æµ‹å‡è®¾å¯ä»¥ä»¥å¼€ç›˜ä»·æˆäº¤

**çœŸå®æƒ…å†µ**:
- 9:15-9:25é›†åˆç«ä»·
- 9:25å¼€ç›˜ä»·æ’®åˆæˆäº¤
- æ— æ³•ä¿è¯ä»¥å¼€ç›˜ä»·å®Œå…¨æˆäº¤

**å»ºè®®**: ä½¿ç”¨å¼€ç›˜å5åˆ†é’Ÿå‡ä»·

**ä¿®å¤ä¼˜å…ˆçº§**: ğŸŸ¡ P2 - Medium

---

### 4.3 Medium: æ–°è‚¡ä¸Šå¸‚é¦–æ—¥è§„åˆ™

**é—®é¢˜**: æœªåŒºåˆ†æ–°è‚¡é¦–æ—¥ï¼ˆæ— æ¶¨è·Œåœé™åˆ¶ï¼‰

**å»ºè®®**: æ·»åŠ ä¸Šå¸‚æ—¥æœŸå­—æ®µ

**ä¿®å¤ä¼˜å…ˆçº§**: ğŸŸ¡ P2 - Medium

---

## 5. æ•°æ®è´¨é‡é—®é¢˜

### 5.1 Critical: ç”Ÿå­˜åå·®ï¼ˆSurvivorship Biasï¼‰

**ä½ç½®**: `data_fetcher.py` ç¬¬19-93è¡Œ

**é—®é¢˜**: ä½¿ç”¨è§„åˆ™ç”Ÿæˆè‚¡ç¥¨ä»£ç ï¼Œæ— æ³•è·å–å†å²æ•°æ®

**å½“å‰é€»è¾‘**:
```python
def generate_stock_codes(prefix, start, end):
    """ç”Ÿæˆè‚¡ç¥¨ä»£ç åˆ—è¡¨ï¼ˆå¦‚000001-000999ï¼‰"""
    stocks = []
    for i in range(start, end + 1):
        stocks.append(f"{prefix}{i:03d}")
    return stocks
```

**é—®é¢˜åˆ†æ**:
- æ— æ³•è·å–**å·²é€€å¸‚**è‚¡ç¥¨çš„å†å²æ•°æ®
- æ— æ³•è·å–**æœªä¸Šå¸‚**è‚¡ç¥¨ï¼ˆä»£ç å·²åˆ†é…ä½†æœªä½¿ç”¨ï¼‰
- å›æµ‹ç»“æœ**è™šé«˜**ï¼ˆåªåŒ…å«å­˜æ´»è‚¡ç¥¨ï¼‰

**çœŸå®æƒ…å†µ**:
```
å‡è®¾2024-01-01å›æµ‹å¼€å§‹æ—¶ï¼š
- 000001-000999ä¸­ï¼Œå®é™…åªæœ‰500åªè‚¡ç¥¨åœ¨äº¤æ˜“
- å…¶ä¸­50åªåæ¥é€€å¸‚ï¼ˆSTåé€€å¸‚ï¼‰
- å›æµ‹åªåŒ…å«ç°å­˜450åªï¼Œé—æ¼äº†50åªäºæŸé€€å¸‚çš„è‚¡ç¥¨

ç»“æœï¼šå›æµ‹æ”¶ç›Šç‡è™šé«˜
```

**é‡åŒ–å½±å“**:
- Aè‚¡å¹´å‡é€€å¸‚ç‡çº¦**1%-2%**
- 5å¹´å›æµ‹æœŸå¯èƒ½é—æ¼5%-10%çš„å¤±è´¥æ¡ˆä¾‹
- ä¼°è®¡å›æµ‹æ”¶ç›Šç‡è™šé«˜**3%-8%**

**ä¿®å¤æ–¹æ¡ˆ**:
```python
# æ–¹æ¡ˆ1: ä½¿ç”¨çœŸå®æˆåˆ†è‚¡åˆ—è¡¨ï¼ˆæ¨èï¼‰
def get_index_constituents(index_code):
    """ä»çœŸå®æ•°æ®æºè·å–æˆåˆ†è‚¡"""
    # ä½¿ç”¨akshareæˆ–tushareè·å–å†å²æˆåˆ†è‚¡åˆ—è¡¨
    # åŒ…æ‹¬å·²é€€å¸‚è‚¡ç¥¨
    pass

# æ–¹æ¡ˆ2: æ·»åŠ å­˜æ´»çŠ¶æ€å­—æ®µ
def check_stock_exists(symbol, date):
    """æ£€æŸ¥è‚¡ç¥¨åœ¨æŒ‡å®šæ—¥æœŸæ˜¯å¦å­˜åœ¨"""
    df = get_stock_data(symbol, date, date)
    return df is not None and len(df) > 0
```

**ä¿®å¤ä¼˜å…ˆçº§**: ğŸ”´ P0 - Critical

---

### 5.2 High: å¤æƒæ–¹å¼æœªç»Ÿä¸€

**ä½ç½®**: `data_fetcher.py` ç¬¬146è¡Œ

**å½“å‰è®¾ç½®**:
```python
df = ak.stock_zh_a_hist(
    symbol=symbol,
    adjust="qfq"  # å‰å¤æƒ
)
```

**é—®é¢˜**: ä½¿ç”¨å‰å¤æƒï¼Œä½†ç­–ç•¥ä¸­æœªè€ƒè™‘è‚¡æ¯å½±å“

**å¤æƒæ–¹å¼å¯¹æ¯”**:
| å¤æƒæ–¹å¼ | ä»·æ ¼ | é€‚ç”¨åœºæ™¯ | é—®é¢˜ |
|---------|------|---------|------|
| å‰å¤æƒ(qfq) | å†å²ä»·æ ¼å‘ä¸‹è°ƒæ•´ | æŠ€æœ¯åˆ†æ | ç»å¯¹ä»·æ ¼å¤±çœŸ |
| åå¤æƒ(hfq) | å†å²ä»·æ ¼å‘ä¸Šè°ƒæ•´ | é•¿æœŸæŠ•èµ„ | æœ€æ–°ä»·æ ¼å¤±çœŸ |
| ä¸å¤æƒ | çœŸå®ä»·æ ¼ | çŸ­æœŸäº¤æ˜“ | åˆ†çº¢é™¤æƒè·³ç©º |

**å»ºè®®**:
- ä½¿ç”¨å‰å¤æƒï¼ˆqfqï¼‰âœ“ å½“å‰å·²æ­£ç¡®
- ä½†éœ€è¦åœ¨æŠ¥å‘Šä¸­è¯´æ˜ä½¿ç”¨äº†å¤æƒæ•°æ®

**ä¿®å¤ä¼˜å…ˆçº§**: ğŸŸ¡ P2 - Mediumï¼ˆè¯´æ˜å³å¯ï¼‰

---

## 6. ç»©æ•ˆæŒ‡æ ‡è®¡ç®—

### 6.1 Critical: æ”¶ç›Šç‡è®¡ç®—é”™è¯¯ï¼ˆæœªè€ƒè™‘å¤åˆ©ï¼‰

**ä½ç½®**: `backtest_engine.py` ç¬¬33è¡Œã€ç¬¬117è¡Œ

**é—®é¢˜ä»£ç **:
```python
# å•åªè‚¡ç¥¨
total_return = trades_df['æ”¶ç›Šç‡%'].sum()  # âŒ ç®€å•æ±‚å’Œ

# å¤šåªè‚¡ç¥¨
total_return = all_returns.sum()  # âŒ ç®€å•æ±‚å’Œ
```

**é”™è¯¯åŸå› **: ä½¿ç”¨**ç®—æœ¯æ±‚å’Œ**è®¡ç®—æ€»æ”¶ç›Šç‡

**é—®é¢˜åˆ†æ**:
```python
# é”™è¯¯æ–¹æ³•ï¼šç®—æœ¯æ±‚å’Œ
äº¤æ˜“1: +10%
äº¤æ˜“2: +10%
æ€»æ”¶ç›Š = 10% + 10% = 20% âŒ

# æ­£ç¡®æ–¹æ³•ï¼šå¤åˆ©è®¡ç®—
åˆå§‹: 100å…ƒ
äº¤æ˜“1: 100 * 1.10 = 110å…ƒ (+10%)
äº¤æ˜“2: 110 * 1.10 = 121å…ƒ (+10%)
æ€»æ”¶ç›Š = (121 - 100) / 100 = 21% âœ“
```

**æ›´ä¸¥é‡çš„é—®é¢˜**:
```python
# äºæŸåç›ˆåˆ©
äº¤æ˜“1: -50%ï¼ˆ100å…ƒ â†’ 50å…ƒï¼‰
äº¤æ˜“2: +50%ï¼ˆ50å…ƒ â†’ 75å…ƒï¼‰

é”™è¯¯æ–¹æ³•: -50% + 50% = 0% âŒ
æ­£ç¡®ç»“æœ: (75 - 100) / 100 = -25% âœ“
```

**æ­£ç¡®å®ç°**:
```python
def calculate_total_return(returns_pct):
    """è®¡ç®—å¤åˆ©æ€»æ”¶ç›Šç‡"""
    # å°†ç™¾åˆ†æ¯”è½¬ä¸ºå€æ•°
    multipliers = (returns_pct / 100 + 1)

    # å¤åˆ©è®¡ç®—
    total_multiplier = multipliers.prod()

    # è½¬å›ç™¾åˆ†æ¯”
    total_return_pct = (total_multiplier - 1) * 100

    return total_return_pct

# ç¤ºä¾‹
trades_returns = pd.Series([10, -5, 8])  # ä¸‰ç¬”äº¤æ˜“
total = calculate_total_return(trades_returns)
# æ­£ç¡®è®¡ç®—ï¼š1.10 * 0.95 * 1.08 - 1 = 0.1286 = 12.86%
# é”™è¯¯è®¡ç®—ï¼š10 + (-5) + 8 = 13%
```

**å½±å“**:
- å›æµ‹æ€»æ”¶ç›Šç‡**ä¸¥é‡å¤±çœŸ**
- å¤šç¬”äº¤æ˜“æ—¶è¯¯å·®ç´¯ç§¯
- äºæŸäº¤æ˜“åçš„æ¢å¤è¢«ä½ä¼°

**ä¿®å¤ä¼˜å…ˆçº§**: ğŸ”´ P0 - Critical

---

### 6.2 High: æœ€å¤§å›æ’¤æœªå®ç°

**ä½ç½®**: `backtest_engine.py`

**é—®é¢˜**: ä»£ç ä¸­**å®Œå…¨æ²¡æœ‰**è®¡ç®—æœ€å¤§å›æ’¤

**æœ€å¤§å›æ’¤å®šä¹‰**:
```python
æœ€å¤§å›æ’¤ = max((peak - valley) / peak)
å…¶ä¸­ï¼špeak = å†å²æœ€é«˜å‡€å€¼
     valley = peakä¹‹åçš„æœ€ä½å‡€å€¼
```

**é‡è¦æ€§**: æœ€å¤§å›æ’¤æ˜¯è¡¡é‡ç­–ç•¥é£é™©çš„**æ ¸å¿ƒæŒ‡æ ‡**

**å®ç°ç¤ºä¾‹**:
```python
def calculate_max_drawdown(equity_curve):
    """è®¡ç®—æœ€å¤§å›æ’¤"""
    peak = equity_curve.expanding(min_periods=1).max()
    drawdown = (equity_curve - peak) / peak
    max_drawdown = drawdown.min()
    return abs(max_drawdown) * 100  # ç™¾åˆ†æ¯”

# æ„å»ºå‡€å€¼æ›²çº¿
equity = [initial_capital]
for trade in trades:
    profit = equity[-1] * (trade['æ”¶ç›Šç‡%'] / 100)
    equity.append(equity[-1] + profit)

max_dd = calculate_max_drawdown(pd.Series(equity))
```

**ä¿®å¤ä¼˜å…ˆçº§**: ğŸŸ  P1 - High

---

### 6.3 High: å¤æ™®æ¯”ç‡æœªå®ç°

**ä½ç½®**: `backtest_engine.py`

**é—®é¢˜**: ç¼ºå°‘é£é™©è°ƒæ•´åæ”¶ç›ŠæŒ‡æ ‡

**å¤æ™®æ¯”ç‡å®šä¹‰**:
```python
å¤æ™®æ¯”ç‡ = (å¹´åŒ–æ”¶ç›Šç‡ - æ— é£é™©åˆ©ç‡) / å¹´åŒ–æ³¢åŠ¨ç‡

å…¶ä¸­ï¼š
- å¹´åŒ–æ”¶ç›Šç‡ = (æ€»æ”¶ç›Šç‡ + 1) ^ (252 / äº¤æ˜“æ—¥æ•°) - 1
- æ— é£é™©åˆ©ç‡ â‰ˆ 2.5%ï¼ˆä¸­å›½å›½å€ºåˆ©ç‡ï¼‰
- å¹´åŒ–æ³¢åŠ¨ç‡ = std(æ—¥æ”¶ç›Šç‡) * sqrt(252)
```

**å®ç°ç¤ºä¾‹**:
```python
def calculate_sharpe_ratio(returns, risk_free_rate=0.025):
    """è®¡ç®—å¤æ™®æ¯”ç‡ï¼ˆå¹´åŒ–ï¼‰"""
    # å‡è®¾returnsæ˜¯æ¯ç¬”äº¤æ˜“çš„æ”¶ç›Šç‡æ•°ç»„
    trading_days = len(returns)

    # å¹´åŒ–æ”¶ç›Šç‡
    total_return = calculate_total_return(returns)  # å¤åˆ©
    annual_return = (1 + total_return / 100) ** (252 / trading_days) - 1

    # å¹´åŒ–æ³¢åŠ¨ç‡
    daily_volatility = np.std(returns / 100)
    annual_volatility = daily_volatility * np.sqrt(252)

    # å¤æ™®æ¯”ç‡
    sharpe = (annual_return - risk_free_rate) / annual_volatility
    return sharpe
```

**ä¿®å¤ä¼˜å…ˆçº§**: ğŸŸ  P1 - High

---

### 6.4 Medium: ç›ˆäºæ¯”è®¡ç®—é—®é¢˜

**ä½ç½®**: `backtest_engine.py` ç¬¬40-42è¡Œ

**å½“å‰ä»£ç **:
```python
avg_profit = trades_df[trades_df['æ”¶ç›Šç‡%'] > 0]['æ”¶ç›Šç‡%'].mean()
avg_loss = abs(trades_df[trades_df['æ”¶ç›Šç‡%'] <= 0]['æ”¶ç›Šç‡%'].mean())
profit_factor = avg_profit / avg_loss if avg_loss > 0 else (1 if avg_profit > 0 else 0)
```

**é—®é¢˜**:
- å°†æ”¶ç›Šç‡=0çš„äº¤æ˜“ç®—ä½œäºæŸ (`<=0`)
- è¾¹ç•Œæƒ…å†µå¤„ç†é€»è¾‘å¤æ‚

**æ”¹è¿›å»ºè®®**:
```python
wins = trades_df[trades_df['æ”¶ç›Šç‡%'] > 0]['æ”¶ç›Šç‡%']
losses = trades_df[trades_df['æ”¶ç›Šç‡%'] < 0]['æ”¶ç›Šç‡%']

avg_profit = wins.mean() if len(wins) > 0 else 0
avg_loss = abs(losses.mean()) if len(losses) > 0 else 0

# ç›ˆäºæ¯”
if avg_loss > 0:
    profit_factor = avg_profit / avg_loss
elif avg_profit > 0:
    profit_factor = float('inf')  # åªæœ‰ç›ˆåˆ©ï¼Œæ— äºæŸ
else:
    profit_factor = 0  # æ— ç›ˆåˆ©
```

**ä¿®å¤ä¼˜å…ˆçº§**: ğŸŸ¡ P2 - Medium

---

## 7. ç­–ç•¥é€»è¾‘åˆç†æ€§

### 7.1 Medium: é‡èƒ½çªç ´ç­–ç•¥å‚æ•°ä¸åˆç†

**ä½ç½®**: `config.py` ç¬¬46-55è¡Œ

**å½“å‰å‚æ•°**:
```python
STRATEGY_PARAMS = {
    "ma_period": 30,
    "hold_days": 3,              # âš ï¸ æŒæœ‰3å¤©å¤ªçŸ­
    "volume_multiplier": 3.0,     # âš ï¸ 3å€é‡èƒ½è¦æ±‚å¤ªé«˜
    "turnover_min": 0.01,         # âš ï¸ 1000ä¸‡å¤ªå°ï¼ˆå¾®ç›˜è‚¡ï¼‰
    "turnover_max": 1000.0,       # âš ï¸ 1000äº¿å¤ªå¤§ï¼ˆæ— é™åˆ¶ï¼‰
}
```

**é—®é¢˜åˆ†æ**:

| å‚æ•° | å½“å‰å€¼ | åˆç†èŒƒå›´ | é—®é¢˜ |
|------|--------|---------|------|
| hold_days | 3å¤© | 5-10å¤© | å¤ªçŸ­ï¼Œå—éšæœºæ³¢åŠ¨å½±å“å¤§ |
| volume_multiplier | 3.0å€ | 1.5-2.0å€ | å¤ªä¸¥æ ¼ï¼Œä¿¡å·è¿‡å°‘ |
| turnover_min | 0.01äº¿ | 1-5äº¿ | ä¼šé€‰ä¸­å¾®ç›˜è‚¡ï¼ˆæµåŠ¨æ€§å·®ï¼‰|
| turnover_max | 1000äº¿ | 50-100äº¿ | æ— å®é™…é™åˆ¶ä½œç”¨ |

**Aè‚¡æˆäº¤é‡‘é¢åˆ†å¸ƒ**:
```
< 1äº¿: å°ç›˜è‚¡ï¼ˆ40%ï¼‰- æµåŠ¨æ€§å·®ï¼Œæ»‘ç‚¹å¤§
1-5äº¿: ä¸­å°ç›˜ï¼ˆ30%ï¼‰- é€‚åˆå°èµ„é‡‘
5-20äº¿: ä¸­ç›˜ï¼ˆ20%ï¼‰- è¾ƒå¥½æµåŠ¨æ€§
> 20äº¿: å¤§ç›˜ï¼ˆ10%ï¼‰- ä¼˜ç§€æµåŠ¨æ€§
```

**å»ºè®®å‚æ•°**:
```python
STRATEGY_PARAMS = {
    "ma_period": 30,
    "hold_days": 5,              # âœ… 5-7å¤©æ›´åˆç†
    "volume_multiplier": 1.8,     # âœ… 1.5-2.0å€
    "turnover_min": 2.0,          # âœ… 2äº¿ä»¥ä¸Šï¼ˆé¿å…å¾®ç›˜è‚¡ï¼‰
    "turnover_max": 50.0,         # âœ… 50äº¿ä»¥ä¸‹ï¼ˆé¿å…ç‰¹å¤§ç›˜ï¼‰
}
```

**ä¿®å¤ä¼˜å…ˆçº§**: ğŸŸ¡ P2 - Medium

---

### 7.2 Medium: æ­¢æŸæ­¢ç›ˆè®¾ç½®æ¬ ç¼º

**ä½ç½®**: `strategy.py` - VolumeBreakoutStrategy

**é—®é¢˜**: VolumeBreakoutStrategy**æ²¡æœ‰æ­¢æŸ**ï¼Œåªæœ‰å›ºå®šæŒæœ‰æœŸ

```python
# å½“å‰é€»è¾‘
Day 1: ä¹°å…¥
Day 2: æŒæœ‰ï¼ˆå³ä½¿æš´è·Œä¹Ÿä¸æ­¢æŸï¼‰
Day 3: æŒæœ‰
Day 4: å¼ºåˆ¶å–å‡ºï¼ˆå¯èƒ½åœ¨æœ€ä½ç‚¹ï¼‰
```

**é£é™©**:
- é‡åˆ°çªå‘åˆ©ç©ºï¼ˆæš´è·Œ10%ï¼‰æ— æ³•æ­¢æŸ
- å›ºå®šæŒæœ‰æœŸå¯èƒ½å–åœ¨æœ€ä½ç‚¹
- ç¼ºä¹é£é™©æ§åˆ¶

**å»ºè®®æ·»åŠ **:
```python
# æ·»åŠ æ­¢æŸé€»è¾‘
if position is not None:
    profit_pct = (current_price - entry_price) / entry_price

    # æ­¢æŸ -5%
    if profit_pct <= -0.05:
        sell_reason = 'æ­¢æŸ'

    # æ­¢ç›ˆ +10%
    elif profit_pct >= 0.10:
        sell_reason = 'æ­¢ç›ˆ'

    # å¦åˆ™æŒæœ‰æ»¡3å¤©åå–å‡º
    elif hold_days >= 3:
        sell_reason = 'åˆ°æœŸ'
```

**ä¿®å¤ä¼˜å…ˆçº§**: ğŸŸ¡ P2 - Medium

---

## 8. å›æµ‹å¯ä¿¡åº¦è¯„åˆ†

### æ€»ä½“è¯„åˆ†ï¼š3.5 / 10 åˆ†

**è¯„åˆ†ä¾æ®**:

| ç»´åº¦ | å¾—åˆ† | æƒé‡ | åŠ æƒ | è¯´æ˜ |
|------|------|------|------|------|
| å‰è§†åå·®æ§åˆ¶ | 1/10 | 30% | 0.3 | å½“æ—¥ä¿¡å·å½“æ—¥ä¹°å…¥ï¼ˆä¸¥é‡é”™è¯¯ï¼‰|
| äº¤æ˜“æˆæœ¬å‡†ç¡®æ€§ | 2/10 | 20% | 0.4 | æ‰‹ç»­è´¹ç‡ä½ä¼°10å€ |
| å¸‚åœºé™åˆ¶è€ƒè™‘ | 2/10 | 20% | 0.4 | æœªè€ƒè™‘æ¶¨è·Œåœã€T+1 |
| æŠ€æœ¯æŒ‡æ ‡å‡†ç¡®æ€§ | 6/10 | 15% | 0.9 | MACDã€KDJæœ‰å°é—®é¢˜ |
| ç»©æ•ˆæŒ‡æ ‡å®Œæ•´æ€§ | 4/10 | 10% | 0.4 | ç¼ºå°‘æœ€å¤§å›æ’¤ã€å¤æ™®æ¯”ç‡ |
| æ•°æ®è´¨é‡ | 3/10 | 5% | 0.15 | ç”Ÿå­˜åå·®ä¸¥é‡ |
| **æ€»åˆ†** | - | - | **3.5** | **å›æµ‹ç»“æœä¸å¯ä¿¡** |

### å¯ä¿¡åº¦ç­‰çº§

```
0-2åˆ†: å®Œå…¨ä¸å¯ä¿¡ - å›æµ‹é€»è¾‘ä¸¥é‡é”™è¯¯
3-4åˆ†: ä½å¯ä¿¡åº¦ - å­˜åœ¨å¤šä¸ªCriticalé—®é¢˜ï¼ˆå½“å‰çŠ¶æ€ï¼‰â¬…
5-6åˆ†: ä¸­ç­‰å¯ä¿¡åº¦ - Criticalé—®é¢˜å·²ä¿®å¤ï¼ŒHighé—®é¢˜å¾…ä¿®å¤
7-8åˆ†: è¾ƒé«˜å¯ä¿¡åº¦ - ä¸»è¦é—®é¢˜å·²ä¿®å¤ï¼Œç»†èŠ‚å¾…å®Œå–„
9-10åˆ†: é«˜å¯ä¿¡åº¦ - æ¥è¿‘çœŸå®äº¤æ˜“ç¯å¢ƒ
```

**å½“å‰çŠ¶æ€**: **ä½å¯ä¿¡åº¦**ï¼ˆ3.5åˆ†ï¼‰
- âŒ 6ä¸ªCriticalé—®é¢˜æœªä¿®å¤
- âŒ 8ä¸ªHighé—®é¢˜æœªä¿®å¤
- âš ï¸ 5ä¸ªMediumé—®é¢˜å¾…æ”¹è¿›

---

## 9. ä¿®å¤ä¼˜å…ˆçº§è·¯çº¿å›¾

### Phase 1: ç«‹å³ä¿®å¤ï¼ˆP0 - Criticalï¼‰
é¢„è®¡å·¥ä½œé‡ï¼š3-5å¤©

#### 1.1 å‰è§†åå·®ä¿®å¤ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
```python
# å½±å“ï¼šæ‰€æœ‰ç­–ç•¥
# ä¿®å¤å†…å®¹ï¼š
1. ä¿¡å·äº§ç”Ÿæ—¥ä¸ä¹°å…¥æ—¥åˆ†ç¦»ï¼ˆæ¬¡æ—¥ä¹°å…¥ï¼‰
2. ä½¿ç”¨æ¬¡æ—¥å¼€ç›˜ä»·æˆ–æ”¶ç›˜ä»·ä¹°å…¥
3. å–å‡ºä¿¡å·åŒæ ·æ¬¡æ—¥æ‰§è¡Œ

# æ–‡ä»¶ï¼šstrategy.py
# æ‰€æœ‰ç­–ç•¥çš„ get_trades() æ–¹æ³•
```

#### 1.2 äº¤æ˜“æˆæœ¬ä¿®æ­£
```python
# å½±å“ï¼šæ‰€æœ‰äº¤æ˜“
# ä¿®å¤å†…å®¹ï¼š
1. æ‰‹ç»­è´¹ç‡ï¼š0.1% â†’ 0.16%
2. æ·»åŠ å°èŠ±ç¨ã€è¿‡æˆ·è´¹
3. è€ƒè™‘æœ€ä½5å…ƒä½£é‡‘

# æ–‡ä»¶ï¼šconfig.py, strategy.py
```

#### 1.3 æ¶¨è·Œåœé™åˆ¶
```python
# å½±å“ï¼šè¿½æ¶¨ç­–ç•¥ã€æ­¢æŸç­–ç•¥
# ä¿®å¤å†…å®¹ï¼š
1. æ£€æµ‹æ¶¨è·ŒåœçŠ¶æ€
2. æ¶¨åœæ—¶æ— æ³•ä¹°å…¥
3. è·Œåœæ—¶æ— æ³•å–å‡º
4. æ·»åŠ é™ä»·æ ‡è®°

# æ–‡ä»¶ï¼šstrategy.py, data_manager.py
```

#### 1.4 T+1åˆ¶åº¦
```python
# å½±å“ï¼šæ‰€æœ‰ç­–ç•¥
# ä¿®å¤å†…å®¹ï¼š
1. ä¹°å…¥å½“æ—¥ä¸èƒ½å–å‡º
2. æœ€çŸ­æŒæœ‰æœŸ1å¤©
3. æ·»åŠ æŒæœ‰å¤©æ•°æ£€æŸ¥

# æ–‡ä»¶ï¼šstrategy.pyï¼ˆæ‰€æœ‰ç­–ç•¥ï¼‰
```

#### 1.5 æ”¶ç›Šç‡å¤åˆ©è®¡ç®—
```python
# å½±å“ï¼šå›æµ‹ç»“æœç»Ÿè®¡
# ä¿®å¤å†…å®¹ï¼š
1. æ€»æ”¶ç›Šç‡æ”¹ä¸ºå¤åˆ©è®¡ç®—
2. ä¿®æ­£ backtest_engine.py çš„èšåˆé€»è¾‘

# æ–‡ä»¶ï¼šbacktest_engine.py
```

#### 1.6 ç”Ÿå­˜åå·®
```python
# å½±å“ï¼šé€‰è‚¡èŒƒå›´
# ä¿®å¤å†…å®¹ï¼š
1. ä½¿ç”¨çœŸå®æˆåˆ†è‚¡åˆ—è¡¨
2. åŒ…å«é€€å¸‚è‚¡ç¥¨å†å²æ•°æ®
3. æ·»åŠ å­˜æ´»çŠ¶æ€æ£€æŸ¥

# æ–‡ä»¶ï¼šdata_fetcher.py
```

**Phase 1 å®Œæˆåé¢„æœŸæå‡**:
- å›æµ‹å¯ä¿¡åº¦ï¼š3.5åˆ† â†’ 6.5åˆ†
- æ”¶ç›Šç‡è°ƒæ•´ï¼šé¢„è®¡ä¸‹é™30%-50%ï¼ˆæ›´æ¥è¿‘çœŸå®ï¼‰

---

### Phase 2: é‡è¦æ”¹è¿›ï¼ˆP1 - Highï¼‰
é¢„è®¡å·¥ä½œé‡ï¼š2-3å¤©

#### 2.1 æŠ€æœ¯æŒ‡æ ‡ä¿®æ­£
- MACDæŸ±çŠ¶å›¾ä¹˜ä»¥2
- RSIæ”¹ç”¨EMAå¹³æ»‘
- KDJè¾¹ç•Œå¤„ç†
- ATRé¦–æ—¥ä¿®æ­£

#### 2.2 æ»‘ç‚¹è°ƒæ•´
- æŒ‰å¸‚å€¼åˆ†ç±»è®¾ç½®æ»‘ç‚¹
- ä»0.02%æå‡åˆ°0.2%

#### 2.3 åœç‰Œå¤„ç†
- æ£€æµ‹æˆäº¤é‡=0çš„åœç‰Œæ—¥
- åœç‰ŒæœŸé—´æ— æ³•äº¤æ˜“

#### 2.4 æœ€å°äº¤æ˜“å•ä½
- ä¹°å…¥è‚¡æ•°å‘ä¸‹å–æ•´åˆ°100çš„å€æ•°
- æ·»åŠ èµ„é‡‘ä¸è¶³æ£€æŸ¥

#### 2.5 ç»©æ•ˆæŒ‡æ ‡å®Œå–„
- æ·»åŠ æœ€å¤§å›æ’¤è®¡ç®—
- æ·»åŠ å¤æ™®æ¯”ç‡
- æ·»åŠ å¹´åŒ–æ”¶ç›Šç‡
- æ·»åŠ èƒœç‡ã€ç›ˆäºæ¯”ä¼˜åŒ–

**Phase 2 å®Œæˆåé¢„æœŸæå‡**:
- å›æµ‹å¯ä¿¡åº¦ï¼š6.5åˆ† â†’ 8.0åˆ†

---

### Phase 3: ä¼˜åŒ–å¢å¼ºï¼ˆP2 - Mediumï¼‰
é¢„è®¡å·¥ä½œé‡ï¼š1-2å¤©

#### 3.1 ç­–ç•¥å‚æ•°ä¼˜åŒ–
- è°ƒæ•´é‡èƒ½å€æ•°ï¼ˆ3.0 â†’ 1.8ï¼‰
- è°ƒæ•´æŒæœ‰å¤©æ•°ï¼ˆ3 â†’ 5-7ï¼‰
- è°ƒæ•´æˆäº¤é¢èŒƒå›´ï¼ˆ0.01-1000äº¿ â†’ 2-50äº¿ï¼‰

#### 3.2 æ·»åŠ æ­¢æŸæœºåˆ¶
- VolumeBreakoutStrategyæ·»åŠ -5%æ­¢æŸ
- ä¼˜åŒ–å…¶ä»–ç­–ç•¥çš„æ­¢æŸé€»è¾‘

#### 3.3 é›†åˆç«ä»·å¤„ç†
- ä½¿ç”¨å¼€ç›˜å5åˆ†é’Ÿå‡ä»·
- æ·»åŠ æˆäº¤é‡æ£€æŸ¥

#### 3.4 å¤æƒè¯´æ˜
- åœ¨æŠ¥å‘Šä¸­æ˜ç¡®è¯´æ˜ä½¿ç”¨å‰å¤æƒæ•°æ®

**Phase 3 å®Œæˆåé¢„æœŸæå‡**:
- å›æµ‹å¯ä¿¡åº¦ï¼š8.0åˆ† â†’ 9.0åˆ†
- ç­–ç•¥ç¨³å®šæ€§æ˜¾è‘—æå‡

---

## 10. é‡‘èé¢†åŸŸæœ€ä½³å®è·µå»ºè®®

### 10.1 å›æµ‹æ ‡å‡†æ£€æŸ¥æ¸…å•

åœ¨å‘å¸ƒä»»ä½•å›æµ‹ç»“æœå‰ï¼Œå¿…é¡»ç¡®è®¤ï¼š

- [ ] **å‰è§†åå·®**: ä¿¡å·äº§ç”Ÿæ—¥ä¸äº¤æ˜“æ—¥åˆ†ç¦»
- [ ] **äº¤æ˜“æˆæœ¬**: åŒ…å«ä½£é‡‘ã€å°èŠ±ç¨ã€è¿‡æˆ·è´¹ã€æ»‘ç‚¹
- [ ] **æ¶¨è·Œåœ**: è€ƒè™‘æ— æ³•æˆäº¤çš„æƒ…å†µ
- [ ] **T+1**: å½“æ—¥ä¹°å…¥ä¸èƒ½å½“æ—¥å–å‡º
- [ ] **æœ€å°äº¤æ˜“å•ä½**: 100è‚¡çš„æ•´æ•°å€
- [ ] **åœç‰Œ**: æ£€æµ‹å¹¶è·³è¿‡åœç‰Œæ—¥
- [ ] **å¤æƒå¤„ç†**: æ˜ç¡®ä½¿ç”¨å‰å¤æƒ/åå¤æƒ
- [ ] **ç”Ÿå­˜åå·®**: åŒ…å«é€€å¸‚è‚¡ç¥¨
- [ ] **å¤åˆ©è®¡ç®—**: æ€»æ”¶ç›Šç‡ä½¿ç”¨å¤åˆ©å…¬å¼
- [ ] **é£é™©æŒ‡æ ‡**: åŒ…å«æœ€å¤§å›æ’¤ã€å¤æ™®æ¯”ç‡

### 10.2 å›æµ‹æŠ¥å‘Šå¿…å¤‡è¦ç´ 

æ¯æ¬¡å›æµ‹æŠ¥å‘Šåº”åŒ…å«ï¼š

#### åŸºç¡€ä¿¡æ¯
- å›æµ‹åŒºé—´ï¼ˆå¼€å§‹-ç»“æŸæ—¥æœŸï¼‰
- è‚¡ç¥¨æ± èŒƒå›´ï¼ˆæŒ‡æ•°æˆåˆ†è‚¡ã€å¸‚å€¼èŒƒå›´ï¼‰
- åˆå§‹èµ„é‡‘
- ç­–ç•¥åç§°å’Œç‰ˆæœ¬

#### æ”¶ç›ŠæŒ‡æ ‡
- æ€»æ”¶ç›Šç‡ï¼ˆå¤åˆ©ï¼‰
- å¹´åŒ–æ”¶ç›Šç‡
- æœ€å¤§å›æ’¤
- å¤æ™®æ¯”ç‡
- å¡ç›æ¯”ç‡ï¼ˆæ”¶ç›Š/æœ€å¤§å›æ’¤ï¼‰

#### äº¤æ˜“ç»Ÿè®¡
- æ€»äº¤æ˜“æ¬¡æ•°
- èƒœç‡
- å¹³å‡ç›ˆåˆ©/å¹³å‡äºæŸ
- ç›ˆäºæ¯”
- æœ€å¤§å•ç¬”ç›ˆåˆ©/äºæŸ
- æœ€é•¿è¿äºæ¬¡æ•°

#### æˆæœ¬å‡è®¾
- åˆ¸å•†ä½£é‡‘ç‡
- å°èŠ±ç¨ç‡
- æ»‘ç‚¹ç‡
- æ˜¯å¦è€ƒè™‘æœ€ä½ä½£é‡‘

#### é£é™©æç¤º
- å›æµ‹å±€é™æ€§è¯´æ˜
- è¿‡æ‹Ÿåˆé£é™©
- å®ç›˜å¯èƒ½é‡åˆ°çš„é—®é¢˜
- ä¸æ„æˆæŠ•èµ„å»ºè®®

### 10.3 å¸¸è§é™·é˜±

**é™·é˜±1: å‚æ•°è¿‡æ‹Ÿåˆ**
```python
# âŒ é”™è¯¯ï¼šæµ‹è¯•100ç§å‚æ•°ç»„åˆï¼Œé€‰æœ€ä¼˜çš„
for ma_period in range(5, 100):
    for volume_mult in [1.5, 2.0, 2.5, 3.0]:
        # ...æµ‹è¯•æ”¶ç›Šç‡
        if return > best_return:
            best_params = (ma_period, volume_mult)

# âœ… æ­£ç¡®ï¼šä½¿ç”¨è®­ç»ƒé›†ä¼˜åŒ–ï¼ŒéªŒè¯é›†æµ‹è¯•
train_period = data[:train_end]
validation_period = data[train_end:valid_end]
test_period = data[valid_end:]

# åœ¨è®­ç»ƒé›†ä¼˜åŒ–å‚æ•°
best_params = optimize(train_period)
# åœ¨éªŒè¯é›†éªŒè¯
validate(validation_period, best_params)
# åœ¨æµ‹è¯•é›†æœ€ç»ˆæµ‹è¯•
final_result = test(test_period, best_params)
```

**é™·é˜±2: å¿½ç•¥äº¤æ˜“æˆæœ¬**
```python
# ç¤ºä¾‹ï¼šé«˜é¢‘ç­–ç•¥çš„æˆæœ¬å½±å“
ç­–ç•¥å¹´åŒ–æ”¶ç›Š: 30%
äº¤æ˜“æ¬¡æ•°: 500æ¬¡/å¹´
å•æ¬¡æˆæœ¬: 0.16%
æ€»æˆæœ¬: 500 * 0.16% = 80%
å‡€æ”¶ç›Š: 30% - 80% = -50% âŒ
```

**é™·é˜±3: å°æ ·æœ¬è¿‡åº¦è‡ªä¿¡**
```python
# ç¤ºä¾‹ï¼š
äº¤æ˜“æ¬¡æ•°: 5æ¬¡
èƒœç‡: 80%ï¼ˆ4èµ¢1è¾“ï¼‰
# âŒ é”™è¯¯ç»“è®ºï¼šç­–ç•¥ä¼˜ç§€

# âœ… æ­£ç¡®åˆ†æï¼š
# æ ·æœ¬å¤ªå°ï¼Œå¯èƒ½æ˜¯è¿æ°”
# è‡³å°‘éœ€è¦30-50ç¬”äº¤æ˜“æ‰æœ‰ç»Ÿè®¡æ„ä¹‰
```

---

## 11. ç»“è®ºä¸å»ºè®®

### 11.1 å½“å‰çŠ¶æ€è¯„ä¼°

**æ€»ä½“è¯„ä»·**: å›æµ‹ç³»ç»Ÿå­˜åœ¨**ä¸¥é‡çš„é‡‘èå‡†ç¡®æ€§é—®é¢˜**ï¼Œå½“å‰å›æµ‹ç»“æœ**ä¸å¯ä¿¡**ã€‚

**æ ¸å¿ƒé—®é¢˜**:
1. **å‰è§†åå·®**æ˜¯æœ€ä¸¥é‡çš„é—®é¢˜ï¼Œå¯¼è‡´å›æµ‹æ”¶ç›Šç‡è™šé«˜30%-50%
2. **äº¤æ˜“æˆæœ¬**ä½ä¼°10å€ï¼Œæ¯ç¬”äº¤æ˜“å¤šç®—0.05%-0.06%æ”¶ç›Š
3. **æ¶¨è·Œåœé™åˆ¶**æœªè€ƒè™‘ï¼Œè¿½æ¶¨ç­–ç•¥å¤±çœŸä¸¥é‡
4. **T+1åˆ¶åº¦**æœªå®ç°ï¼Œæ­¢æŸé€»è¾‘é”™è¯¯
5. **ç”Ÿå­˜åå·®**å¯¼è‡´å›æµ‹åªåŒ…å«å­˜æ´»è‚¡ç¥¨
6. **æ”¶ç›Šç‡è®¡ç®—**ä½¿ç”¨ç®—æœ¯æ±‚å’Œè€Œéå¤åˆ©

### 11.2 ä¿®å¤æ•ˆæœé¢„æµ‹

å‡è®¾ä¿®å¤æ‰€æœ‰Criticalå’ŒHighé—®é¢˜åï¼š

| ç­–ç•¥ | ä¿®å¤å‰æ”¶ç›Šç‡ | é¢„è®¡ä¿®å¤å | ä¸‹é™å¹…åº¦ |
|------|-------------|-----------|---------|
| é‡èƒ½çªç ´ç­–ç•¥ | +30% | +10% ~ +15% | -50% |
| ç¨³å¥è¶‹åŠ¿ç­–ç•¥ | +25% | +8% ~ +12% | -52% |
| æ¿€è¿›åŠ¨é‡ç­–ç•¥ | +40% | +12% ~ +18% | -55% |
| å¹³è¡¡å¤šå› å­ç­–ç•¥ | +20% | +6% ~ +10% | -50% |

**é¢„è®¡æ•´ä½“å½±å“**:
- å›æµ‹æ”¶ç›Šç‡ä¸‹é™**40%-60%**
- äº¤æ˜“æ¬¡æ•°å‡å°‘**20%-30%**ï¼ˆæ¶¨è·Œåœæ— æ³•æˆäº¤ï¼‰
- æœ€å¤§å›æ’¤å¢åŠ **50%-100%**ï¼ˆæ­¢æŸå»¶è¿Ÿæ‰§è¡Œï¼‰

### 11.3 æœ€ç»ˆå»ºè®®

#### ç»™å¼€å‘å›¢é˜Ÿçš„å»ºè®®

1. **ç«‹å³åœæ­¢ä½¿ç”¨å½“å‰å›æµ‹ç»“æœ**
   - å½“å‰æ•°æ®ä¸¥é‡å¤±çœŸï¼Œä¸èƒ½ä½œä¸ºæŠ•èµ„ä¾æ®
   - å‘ä½¿ç”¨è€…æ¾„æ¸…å›æµ‹å±€é™æ€§

2. **æŒ‰ä¼˜å…ˆçº§ä¿®å¤é—®é¢˜**
   - Phase 1ï¼ˆP0ï¼‰å¿…é¡»å…¨éƒ¨ä¿®å¤æ‰èƒ½ç»§ç»­ä½¿ç”¨
   - Phase 2ï¼ˆP1ï¼‰å¼ºçƒˆå»ºè®®ä¿®å¤
   - Phase 3ï¼ˆP2ï¼‰æ ¹æ®èµ„æºæƒ…å†µé€‰æ‹©æ€§ä¿®å¤

3. **å»ºç«‹å›æµ‹éªŒè¯æµç¨‹**
   - æ¯æ¬¡ä¿®æ”¹ç­–ç•¥åï¼Œè¿è¡Œå®Œæ•´æµ‹è¯•
   - å¯¹æ¯”ä¿®å¤å‰åçš„æ”¶ç›Šç‡å·®å¼‚
   - è®°å½•ä¿®å¤æ—¥å¿—

4. **æ·»åŠ è‡ªåŠ¨åŒ–æ£€æµ‹**
   - åœ¨å•å…ƒæµ‹è¯•ä¸­åŠ å…¥å‰è§†åå·®æ£€æµ‹
   - è‡ªåŠ¨æ£€æŸ¥T+1è§„åˆ™
   - éªŒè¯äº¤æ˜“æˆæœ¬è®¡ç®—

#### ç»™ç­–ç•¥ä½¿ç”¨è€…çš„å»ºè®®

1. **è°¨æ…å¯¹å¾…å›æµ‹ç»“æœ**
   - å½“å‰å›æµ‹æ”¶ç›Šç‡è™šé«˜30%-50%
   - å®ç›˜æ”¶ç›Šå¯èƒ½è¿œä½äºå›æµ‹

2. **å°èµ„é‡‘è¯•é”™**
   - å»ºè®®ç”¨å°ä»“ä½ï¼ˆ5%-10%èµ„é‡‘ï¼‰å…ˆè¯•è¿è¡Œ
   - è§‚å¯Ÿè‡³å°‘3-6ä¸ªæœˆ
   - è®°å½•å®ç›˜ä¸å›æµ‹çš„åå·®

3. **è®¾ç½®æ­¢æŸ**
   - å•ç¬”æœ€å¤§äºæŸï¼š-5%
   - è´¦æˆ·æœ€å¤§å›æ’¤ï¼š-15%
   - è¶…è¿‡æ­¢æŸçº¿ç«‹å³åœæ­¢ç­–ç•¥

4. **ç†æ€§é¢„æœŸ**
   - Aè‚¡é•¿æœŸå¹´åŒ–æ”¶ç›Šçº¦8%-12%
   - é‡åŒ–ç­–ç•¥å¹´åŒ–æ”¶ç›Š15%-20%å·²ç»å¾ˆä¼˜ç§€
   - è­¦æƒ•30%+çš„"é«˜æ”¶ç›Š"æ‰¿è¯º

---

## é™„å½•A: å¿«é€Ÿä¿®å¤ä»£ç ç¤ºä¾‹

### A.1 ä¿®å¤å‰è§†åå·®ï¼ˆæ‰€æœ‰ç­–ç•¥é€šç”¨ï¼‰

```python
# ä¿®å¤å‰ï¼ˆé”™è¯¯ï¼‰
def get_trades(self, df):
    df_signals = self.calculate_signals(df)
    trades = []
    position = None

    for i, row in df_signals.iterrows():
        if row['Buy_Signal'] and position is None:
            position = {
                'buy_date': row['æ—¥æœŸ'],
                'buy_price': row['æ”¶ç›˜'],  # âŒ é”™è¯¯
            }

# ä¿®å¤åï¼ˆæ­£ç¡®ï¼‰
def get_trades(self, df):
    df_signals = self.calculate_signals(df)
    trades = []
    position = None

    for i in range(len(df_signals)):
        row = df_signals.iloc[i]

        # æ£€æŸ¥å‰ä¸€æ—¥ä¿¡å·ï¼Œä»Šæ—¥ä¹°å…¥
        if i > 0 and df_signals.iloc[i-1]['Buy_Signal'] and position is None:
            position = {
                'buy_date': row['æ—¥æœŸ'],
                'buy_price': row['å¼€ç›˜'],  # âœ… æ¬¡æ—¥å¼€ç›˜ä»·
            }

        # æ£€æŸ¥å‰ä¸€æ—¥å–å‡ºä¿¡å·ï¼Œä»Šæ—¥å–å‡º
        if i > 0 and position is not None:
            if df_signals.iloc[i-1]['Sell_Signal']:
                sell_date = row['æ—¥æœŸ']
                sell_price = row['å¼€ç›˜']  # âœ… æ¬¡æ—¥å¼€ç›˜ä»·
                # ...è®°å½•äº¤æ˜“
```

### A.2 ä¿®å¤äº¤æ˜“æˆæœ¬

```python
# æ·»åŠ åˆ° config.py
TRANSACTION_COSTS = {
    'commission_rate': 0.00025,      # ä¸‡2.5ä½£é‡‘
    'stamp_duty_rate': 0.001,        # åƒ1å°èŠ±ç¨
    'transfer_fee_rate': 0.00001,    # ä¸‡0.1è¿‡æˆ·è´¹
    'min_commission': 5,             # æœ€ä½5å…ƒä½£é‡‘
}

# ä¿®æ”¹ strategy.py
def calculate_transaction_cost(buy_amount, sell_amount):
    """è®¡ç®—å®Œæ•´äº¤æ˜“æˆæœ¬"""
    # ä¹°å…¥ä½£é‡‘
    buy_comm = max(buy_amount * 0.00025, 5)
    # å–å‡ºä½£é‡‘
    sell_comm = max(sell_amount * 0.00025, 5)
    # å°èŠ±ç¨ï¼ˆä»…å–å‡ºï¼‰
    stamp = sell_amount * 0.001
    # è¿‡æˆ·è´¹ï¼ˆåŒå‘ï¼‰
    transfer = (buy_amount + sell_amount) * 0.00001

    total_cost = buy_comm + sell_comm + stamp + transfer
    cost_rate = total_cost / buy_amount * 100
    return cost_rate

# ä½¿ç”¨
buy_amount = buy_price * volume
sell_amount = sell_price * volume
cost_pct = calculate_transaction_cost(buy_amount, sell_amount)
profit_pct_after_fee = profit_pct - cost_pct
```

### A.3 ä¿®å¤æ¶¨è·Œåœæ£€æµ‹

```python
def check_limit_status(df, idx):
    """æ£€æŸ¥æ¶¨è·ŒåœçŠ¶æ€"""
    if idx == 0:
        return 'normal'

    row = df.iloc[idx]
    prev_close = df.iloc[idx-1]['æ”¶ç›˜']
    current_close = row['æ”¶ç›˜']

    change_pct = (current_close - prev_close) / prev_close

    # ä¸»æ¿è‚¡ç¥¨ï¼ˆå‡è®¾ï¼‰
    if change_pct >= 0.099:
        return 'limit_up'
    elif change_pct <= -0.099:
        return 'limit_down'
    else:
        return 'normal'

# åœ¨ä¹°å…¥é€»è¾‘ä¸­ä½¿ç”¨
if prev_buy_signal and position is None:
    limit_status = check_limit_status(df, i)
    if limit_status != 'limit_up':
        # å¯ä»¥ä¹°å…¥
        position = {'buy_date': row['æ—¥æœŸ'], ...}
```

### A.4 ä¿®å¤T+1æ£€æŸ¥

```python
# åœ¨æ‰€æœ‰ç­–ç•¥çš„å–å‡ºé€»è¾‘å‰æ·»åŠ 
if position is not None:
    # è®¡ç®—æŒæœ‰å¤©æ•°
    hold_days = (row['æ—¥æœŸ'] - position['buy_date']).days

    # T+1æ£€æŸ¥ï¼šå¿…é¡»æŒæœ‰è‡³å°‘1å¤©
    if hold_days < 1:
        continue  # è·³è¿‡å–å‡ºé€»è¾‘

    # æ­¢æŸ/æ­¢ç›ˆé€»è¾‘
    # ...
```

### A.5 ä¿®å¤å¤åˆ©è®¡ç®—

```python
# ä¿®æ”¹ backtest_engine.py
def aggregate_results(results):
    """èšåˆç»“æœï¼ˆä½¿ç”¨å¤åˆ©ï¼‰"""
    all_returns = []

    for symbol, result in results.items():
        if 'trades_df' in result:
            all_returns.extend(result['trades_df']['æ”¶ç›Šç‡%'].tolist())

    if not all_returns:
        return {...}

    # å¤åˆ©è®¡ç®—æ€»æ”¶ç›Šç‡
    multipliers = [(r / 100 + 1) for r in all_returns]
    total_multiplier = np.prod(multipliers)
    total_return = (total_multiplier - 1) * 100

    return {
        'total_return': total_return,  # âœ… å¤åˆ©
        # ...
    }
```

---

## é™„å½•B: å‚è€ƒèµ„æ–™

### B.1 Aè‚¡äº¤æ˜“è§„åˆ™

- ä¸Šäº¤æ‰€äº¤æ˜“è§„åˆ™: http://www.sse.com.cn/lawandrules/
- æ·±äº¤æ‰€äº¤æ˜“è§„åˆ™: http://www.szse.cn/lawrules/
- ä¸­å›½è¯ç›‘ä¼šè§„ç« : http://www.csrc.gov.cn/

### B.2 æŠ€æœ¯æŒ‡æ ‡æ ‡å‡†

- é€šè¾¾ä¿¡æŠ€æœ¯æŒ‡æ ‡å…¬å¼: https://www.tdx.com.cn/
- åŒèŠ±é¡ºæŒ‡æ ‡ç®—æ³•: https://www.10jqka.com.cn/
- TA-LibæŠ€æœ¯åˆ†æåº“: https://ta-lib.org/

### B.3 é‡åŒ–å›æµ‹æœ€ä½³å®è·µ

- Quantopian: Common mistakes in backtesting
- QuantConnect: Algorithm Framework
- Zipline: Backtesting best practices

---

**æŠ¥å‘Šç»“æŸ**

---

**å®¡æŸ¥äºº**: Claude (Financial Accuracy Reviewer)
**å®¡æŸ¥æ—¥æœŸ**: 2026-02-16
**ä¸‹æ¬¡å®¡æŸ¥å»ºè®®**: Phase 1ä¿®å¤å®Œæˆå

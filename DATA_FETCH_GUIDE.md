# 📥 数据获取完整指南

## 概述

新增数据获取功能支持：
- ✅ 按**板块**批量获取数据
- ✅ 设定**时间范围**（开始/结束日期）
- ✅ 5个主流板块：沪深A股、创业板、科创板、深成指、中证500
- ✅ 实时进度显示和缓存管理

---

## 🌐 Web界面访问

打开浏览器访问：**http://localhost:5000**

进入 **📊 数据管理** 标签页，您将看到三个数据获取区域

---

## 📊 三种数据获取方式

### 方式1️⃣：单只股票获取（快速）

**适用场景**：测试单个股票

```
1. 输入股票代码（如：000001）
2. 点击 "获取数据" 按钮
3. 或点击 "增量更新" 只更新新数据
```

**特点**：
- 最快速（秒级）
- 无需等待
- 适合快速验证

---

### 方式2️⃣：按板块批量获取（推荐）⭐

**适用场景**：获取整个板块的策略数据进行对比分析

**步骤**：

```
1. 选择板块
   - 沪深A股 (上证指数，主板市场)
   - 创业板 (创业板指数)
   - 科创板 (科创板代表股)
   - 深成指 (深圳成分指数)
   - 中证500 (中证500指数)

2. 设置时间范围
   - 开始日期：2024-01-01
   - 结束日期：2025-02-13

3. 点击 "批量获取板块数据" 按钮
```

**获取数量**：前20只成分股（可在config.py中修改MAX_STOCKS）

**特点**：
- 🎯 按板块组织数据
- 📅 支持自定义时间范围
- 🔄 后台异步执行
- 💾 自动缓存到本地SQLite

---

### 方式3️⃣：快速获取中证500（预设）

**适用场景**：快速获取默认板块（中证500）

```
1. 点击 "快速获取中证500" 按钮
2. 使用默认时间范围和中证500板块
```

**特点**：
- 一键获取
- 预设参数
- 快速验证

---

## 📋 可选板块详解

### 沪深A股
- **代码**：000001
- **名称**：上证指数
- **范围**：沪深两市主板市场
- **特点**：最全面的A股市场数据

### 创业板
- **代码**：399006
- **名称**：创业板指数
- **范围**：深交所创业板
- **特点**：高成长性公司集中

### 科创板
- **代码**：000688
- **名称**：科创板代表
- **范围**：上交所科创板
- **特点**：科技创新企业

### 深成指
- **代码**：399001
- **名称**：深圳成分指数
- **范围**：深交所主板
- **特点**：深圳市场代表

### 中证500
- **代码**：000905
- **名称**：中证500指数
- **范围**：中等规模企业
- **特点**：平衡性较好

---

## 🚀 使用流程示例

### 场景：对比不同板块的策略表现

**第1步**：获取沪深A股数据
```
1. 选择板块：沪深A股
2. 时间范围：2024-01-01 ~ 2025-02-13
3. 点击"批量获取板块数据"
4. 等待完成（显示"已开始获取沪深A股(20只股票)..."）
```

**第2步**：获取创业板数据
```
1. 选择板块：创业板
2. 时间范围：相同（自动填充）
3. 点击"批量获取板块数据"
```

**第3步**：获取中证500数据
```
1. 选择板块：中证500
2. 时间范围：相同
3. 点击"批量获取板块数据"
```

**第4步**：查看缓存状态
```
1. 切换到"ℹ️ 状态"标签页
2. 查看"总记录数"、"数据库大小"等
3. 查看"更新日志"了解每只股票的数据情况
```

**第5步**：进行回测
```
1. 切换到"🔄 回测"标签页
2. 输入股票代码（从前面获取的数据中选择）
3. 点击"运行回测"
4. 查看回测结果和详细交易记录
```

---

## 💾 数据缓存说明

### 缓存位置
- **数据库文件**：`./stock_data.db`
- **保存位置**：项目根目录

### 缓存状态查看
访问"ℹ️ 状态"标签页查看：
- ✓ 总记录数
- ✓ 数据库大小（MB）
- ✓ 数据库文件位置
- ✓ 每只股票的更新日志

### 增量更新
```
单只股票更新（仅获取新数据）：
1. 输入股票代码
2. 点击"增量更新"按钮
3. 系统只下载最新的数据
```

### 清空缓存
```
危险操作（在"状态"标签页）：
1. 点击"清空所有缓存"按钮
2. 确认删除所有缓存数据
⚠️ 此操作无法撤销！
```

---

## ⚙️ 高级配置

### 修改获取数量

编辑 `config.py`：
```python
MAX_STOCKS = 20  # 改为需要的数量，如50、100等
```

### 添加新板块

编辑 `config.py`，修改SECTORS配置：
```python
SECTORS = {
    "新板块": {
        "code": "指数代码",
        "name": "指数名称",
        "description": "描述信息"
    }
}
```

### 修改默认时间范围

编辑 `config.py`：
```python
START_DATE = "20230101"  # 修改开始日期
END_DATE = "20250213"    # 修改结束日期
```

---

## 🔧 API文档

### 获取板块列表
```
GET /api/sectors

返回示例：
{
  "success": true,
  "sectors": [
    {
      "key": "沪深A股",
      "name": "上证指数",
      "description": "沪深两市主板市场"
    },
    ...
  ]
}
```

### 按板块批量获取
```
POST /api/cache/batch-fetch-sector

请求参数：
{
  "sector": "创业板",
  "start_date": "20240101",
  "end_date": "20250213"
}

返回示例：
{
  "success": true,
  "task_id": "batch_sector_创业板_...",
  "sector": "创业板",
  "stocks_count": 20,
  "start_date": "20240101",
  "end_date": "20250213",
  "stocks": ["code1", "code2", ...],
  "message": "已开始批量获取创业板(20只)，请稍候..."
}
```

### 获取缓存状态
```
GET /api/cache/status

返回示例：
{
  "success": true,
  "total_records": 5000,
  "db_size": 2.5,
  "db_file": "D:\\ai_work\\stock_test\\stock_data.db",
  "update_logs": [...]
}
```

---

## 📝 常见问题

**Q1: 获取速度太慢？**
```
A: 首次获取需要从网络下载，较慢是正常的。
   之后的增量更新会快很多。
   可以选择较少的MAX_STOCKS数量进行快速测试。
```

**Q2: 无法获取某个板块？**
```
A: 检查：
   1. 网络连接是否正常
   2. 板块代码是否正确
   3. efinance/akshare库是否可用
   可尝试使用单只股票获取测试网络连接。
```

**Q3: 如何只更新部分股票？**
```
A: 使用"增量更新"功能：
   1. 输入单只股票代码
   2. 点击"增量更新"按钮
   3. 只更新该股票的新数据
```

**Q4: 数据库占用空间很大？**
```
A: 可以清空缓存并重新获取较少的股票：
   1. 点击"清空所有缓存"
   2. 减小MAX_STOCKS数量
   3. 重新获取数据
```

**Q5: 时间范围如何设置？**
```
A: 使用日期选择器：
   1. 点击日期输入框
   2. 选择开始日期和结束日期
   3. 格式自动为YYYY-MM-DD
   4. 提交时自动转换为YYYYMMDD格式
```

---

## 📈 完整工作流

```
启动应用
    ↓
http://localhost:5000
    ↓
选择"📊 数据管理"标签
    ↓
选择板块和时间范围
    ↓
点击"批量获取板块数据"
    ↓
等待获取完成（后台异步）
    ↓
查看缓存状态
    ↓
切换到"🔄 回测"标签
    ↓
输入股票代码进行回测
    ↓
查看⚙️参数配置调整参数
    ↓
重新回测对比效果
    ↓
✅ 完成！
```

---

## 🎯 优化建议

1. **首次使用**：先选择中证500快速测试系统
2. **逐步扩展**：之后按需获取其他板块数据
3. **定期更新**：使用"增量更新"保持数据最新
4. **监控缓存**：定期检查缓存状态，及时清理
5. **参数优化**：对不同板块使用不同的策略参数

---

**版本**：1.0
**最后更新**：2025-02-13
**状态**：✅ 完全实现

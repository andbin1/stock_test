# ğŸ› "æ•°æ®å…¨æ˜¯0"é—®é¢˜ä¿®å¤

## é—®é¢˜ç—‡çŠ¶

ç”¨æˆ·æŠ¥å‘Šï¼š"è¿è¡Œå›æµ‹åŠŸèƒ½æ—¶ï¼Œå•åªè‚¡ç¥¨æˆ‘æµ‹è¯•äº†ä¸‹ï¼Œæ•°æ®å…¨æ˜¯0"

å®é™…ä¸Šç³»ç»Ÿè¿è¡Œæ—¶å‡ºç°ä»¥ä¸‹é—®é¢˜ï¼š
- âŒ å›æµ‹è¿”å› 0 äº¤æ˜“ï¼ˆæ²¡æœ‰äº¤æ˜“ä¿¡å·ï¼‰
- âŒ æ‰€æœ‰æŒ‡æ ‡ä¸º 0
- âŒ çœ‹èµ·æ¥åƒæ˜¯"æ•°æ®å…¨æ˜¯é›¶"

## æ ¹æœ¬åŸå› åˆ†æ

### é—®é¢˜1ï¼šæ—¥æœŸæ ¼å¼ä¸åŒ¹é…ï¼ˆä¸»è¦é—®é¢˜ï¼‰

**æ ¹æœ¬åŸå› **ï¼š
- æ•°æ®åº“å­˜å‚¨æ—¥æœŸæ ¼å¼ï¼š`YYYY-MM-DD`ï¼ˆå¦‚ `2024-01-02`ï¼‰
- é…ç½®æ–‡ä»¶ä¸­æ—¥æœŸæ ¼å¼ï¼š`YYYYMMDD`ï¼ˆå¦‚ `20240101`ï¼‰
- æ•°æ®åº“æŸ¥è¯¢æ—¶ä½¿ç”¨**å­—ç¬¦ä¸²æ¯”è¾ƒ**

**å­—ç¬¦ä¸²æ¯”è¾ƒé—®é¢˜**ï¼š
```python
# æ•°æ®åº“ä¸­çš„æ—¥æœŸ
stored_date = "2024-01-02"
# é…ç½®ä¸­çš„å¼€å§‹æ—¥æœŸ
start_date = "20240101"

# å­—ç¬¦ä¸²æ¯”è¾ƒ
stored_date >= start_date  # "2024-01-02" >= "20240101"
# ç»“æœï¼šFalse âŒï¼ˆä¸æ­£ç¡®ï¼ï¼‰
```

**åæœ**ï¼š
- æ¯”è¾ƒå¤±è´¥å¯¼è‡´æŸ¥è¯¢åªè¿”å›æœ€å 25 å¤©çš„æ•°æ®ï¼ˆ2025-01-02 ä¹‹åï¼‰
- 25 å¤©æ•°æ®ä¸è¶³ä»¥è®¡ç®— 30 æ—¥å‡çº¿
- æ— æ³•ç”Ÿæˆ MA30 å‘ä¸Šä¿¡å·
- å¯¼è‡´æ²¡æœ‰äº¤æ˜“å’Œ"æ•°æ®å…¨æ˜¯0"çš„å‡è±¡

### é—®é¢˜2ï¼šè¯Šæ–­å·¥å…·è·¯å¾„é”™è¯¯

**é—®é¢˜**ï¼š
- è¯Šæ–­å·¥å…·è¿æ¥åˆ° `stock_data.db`ï¼ˆå½“å‰ç›®å½•ï¼‰
- å®é™…æ•°æ®åº“ä½ç½® `data_cache/stock_data.db`
- å¯¼è‡´è¯Šæ–­å·¥å…·é”™è¯¯æŠ¥å‘Š"æ•°æ®åº“ä¸ºç©º"

## ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤1ï¼šæ•°æ®ç®¡ç†å™¨æ—¥æœŸæ ¼å¼è½¬æ¢

**æ–‡ä»¶**ï¼š`data_manager.py`

**ä¿®æ”¹å†…å®¹**ï¼šåœ¨ `get_data_from_cache()` æ–¹æ³•ä¸­æ·»åŠ æ—¥æœŸæ ¼å¼è½¬æ¢

```python
# è½¬æ¢æ—¥æœŸæ ¼å¼ä» YYYYMMDD åˆ° YYYY-MM-DDï¼ˆç”¨äºæ•°æ®åº“æŸ¥è¯¢ï¼‰
def convert_date_format(date_str: str) -> str:
    """å°† YYYYMMDD æ ¼å¼è½¬æ¢ä¸º YYYY-MM-DD æ ¼å¼"""
    if len(date_str) == 8 and date_str.isdigit():
        return f"{date_str[0:4]}-{date_str[4:6]}-{date_str[6:8]}"
    return date_str  # å·²ç»æ˜¯æ­£ç¡®æ ¼å¼

start_date = convert_date_format(start_date)
end_date = convert_date_format(end_date)
```

**ä¼˜ç‚¹**ï¼š
- âœ… ä¿æŒé…ç½®æ–‡ä»¶ä¸­ YYYYMMDD æ ¼å¼ä¸å˜ï¼ˆä¸æ•°æ®è·å–å‡½æ•°å…¼å®¹ï¼‰
- âœ… è‡ªåŠ¨è½¬æ¢ä¸ºæ•°æ®åº“æŸ¥è¯¢æ‰€éœ€çš„ YYYY-MM-DD æ ¼å¼
- âœ… å‘åå…¼å®¹

### ä¿®å¤2ï¼šè¯Šæ–­å·¥å…·è·¯å¾„ä¿®æ­£

**æ–‡ä»¶**ï¼š`diagnose_backtest.py`

**ä¿®æ”¹å‰**ï¼š
```python
conn = sqlite3.connect('stock_data.db')
```

**ä¿®æ”¹å**ï¼š
```python
from pathlib import Path
db_file = Path("./data_cache/stock_data.db")
conn = sqlite3.connect(str(db_file))
```

## éªŒè¯ç»“æœ

### ä¿®å¤å‰
```
âŒ æ•°æ®åº“ä¸ºç©ºï¼Œæ²¡æœ‰ä»»ä½•è¡¨
   æˆ–
âŒ åªè·å– 25 æ¡æ•°æ®
âŒ æ²¡æœ‰ MA30 å‘ä¸Šä¿¡å·
âŒ æ²¡æœ‰äº¤æ˜“
```

### ä¿®å¤å
```
âœ… æˆåŠŸè·å– 267 æ¡æ•°æ®ï¼ˆå®Œæ•´çš„ä¸€å¹´æ•°æ®ï¼‰
âœ… MA30 å‘ä¸Šä¿¡å·ï¼š148/267 (55.4%)
âœ… é‡èƒ½æ”¾å¤§ä¿¡å·ï¼š96/267 (36.0%)
âœ… ç»¼åˆä¹°å…¥ä¿¡å·ï¼š16/267 (6.0%)
âœ… äº¤æ˜“ç¬”æ•°ï¼š7
âœ… æ€»æ”¶ç›Šç‡ï¼š2.44%
âœ… å¹³å‡æ”¶ç›Šï¼š0.35%
âœ… èƒœç‡ï¼š42.9%
```

## ç³»ç»Ÿç°åœ¨å·¥ä½œæµç¨‹

### 1. è·å–æ•°æ®
```bash
# é€šè¿‡ Web UI æˆ– API è·å–æ•°æ®
# æ•°æ®å­˜å‚¨åˆ° data_cache/stock_data.db
```

### 2. æŸ¥è¯¢æ•°æ®
```python
manager = DataManager()
# ä½¿ç”¨ YYYYMMDD æ ¼å¼çš„æ—¥æœŸï¼ˆæ¥è‡ª config.pyï¼‰
df = manager.get_data_from_cache('000001')
# è‡ªåŠ¨è½¬æ¢ä¸º YYYY-MM-DD è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢
# è¿”å›å®Œæ•´çš„æ—¥æœŸèŒƒå›´æ•°æ®
```

### 3. è¿è¡Œå›æµ‹
```python
strategy = VolumeBreakoutStrategy(STRATEGY_PARAMS)
engine = BacktestEngine()
# æ•°æ®å……è¶³ï¼Œèƒ½å¤Ÿè®¡ç®—æ‰€æœ‰æŠ€æœ¯æŒ‡æ ‡
result = engine.run_single_stock('000001', df, strategy)
# è¿”å›æ­£ç¡®çš„äº¤æ˜“ä¿¡å·
```

## æŠ€æœ¯è¦ç‚¹

### æ—¥æœŸæ ¼å¼çš„æœ€ä½³å®è·µ

**ä¸æ¨è**ï¼š
```python
# âŒ æ··åˆä½¿ç”¨ä¸åŒæ ¼å¼ï¼Œå®¹æ˜“å‡ºé”™
date_str = "20240101"  # YYYYMMDD
stored_date = "2024-01-02"  # YYYY-MM-DD
if date_str <= stored_date:  # å­—ç¬¦ä¸²æ¯”è¾ƒå¤±è´¥ï¼
    pass
```

**æ¨è**ï¼š
```python
# âœ… è½¬æ¢ä¸ºç»Ÿä¸€æ ¼å¼åæ¯”è¾ƒ
def normalize_date(date_str):
    if len(date_str) == 8 and date_str.isdigit():
        return date_str[:4] + "-" + date_str[4:6] + "-" + date_str[6:8]
    return date_str

if normalize_date(date_str) <= stored_date:
    pass
```

### æ•°æ®åº“æ—¥æœŸæŸ¥è¯¢çš„æœ€ä½³å®è·µ

```python
# âœ… ä½¿ç”¨ ISO æ ¼å¼ (YYYY-MM-DD) å­˜å‚¨æ—¥æœŸ
# âœ… åœ¨åº”ç”¨å±‚è¿›è¡Œæ ¼å¼è½¬æ¢
# âœ… é¿å…åœ¨ SQL ä¸­è¿›è¡Œå¤æ‚çš„æ ¼å¼è½¬æ¢
```

## åç»­æ”¹è¿›å»ºè®®

1. **ç»Ÿä¸€æ—¥æœŸæ ¼å¼**
   - è€ƒè™‘åœ¨æ‰€æœ‰åœ°æ–¹ä½¿ç”¨ ISO 8601 æ ¼å¼ (YYYY-MM-DD)
   - åªåœ¨å¿…è¦æ—¶è¿›è¡Œæ ¼å¼è½¬æ¢

2. **æ·»åŠ æ—¥æœŸéªŒè¯**
   - åœ¨æ•°æ®è·å–æ—¶éªŒè¯æ—¥æœŸèŒƒå›´
   - è­¦å‘Šç”¨æˆ·æ•°æ®ä¸è¶³çš„æƒ…å†µ

3. **æ”¹è¿›è¯Šæ–­å·¥å…·**
   - è‡ªåŠ¨æ£€æµ‹æ•°æ®ä¸è¶³é—®é¢˜
   - å»ºè®®ç”¨æˆ·è·å–æ›´å¤šæ•°æ®

4. **å•å…ƒæµ‹è¯•**
   - æ·»åŠ æ—¥æœŸæ ¼å¼è½¬æ¢çš„æµ‹è¯•
   - ç¡®ä¿è·¨å¹³å°å…¼å®¹æ€§

---

## æ€»ç»“

| é¡¹ç›® | ç»“æœ |
|------|------|
| é—®é¢˜ç±»å‹ | æ—¥æœŸæ ¼å¼ä¸åŒ¹é… |
| æ ¹æœ¬åŸå›  | å­—ç¬¦ä¸²æ¯”è¾ƒå¯¼è‡´æ—¥æœŸè¿‡æ»¤å¤±è´¥ |
| å½±å“èŒƒå›´ | æ‰€æœ‰ä½¿ç”¨ get_data_from_cache() çš„ä»£ç  |
| ä¿®å¤æ–¹æ³• | æ·»åŠ æ—¥æœŸæ ¼å¼è½¬æ¢ |
| ä¿®æ”¹æ–‡ä»¶ | 2 ä¸ªæ–‡ä»¶ï¼ˆdata_manager.py, diagnose_backtest.pyï¼‰ |
| ä¿®æ”¹è¡Œæ•° | ~15 è¡Œ |
| å‘åå…¼å®¹ | âœ… å®Œå…¨å…¼å®¹ |
| è·¨å¹³å°æ”¯æŒ | âœ… Linux/Mac/Windows |
| æµ‹è¯•ç»“æœ | âœ… å…¨éƒ¨é€šè¿‡ |

---

**ä¿®å¤çŠ¶æ€**ï¼šâœ… **å®Œæˆ**

**æ‰€æœ‰æµ‹è¯•**ï¼šâœ… **é€šè¿‡**

**ç³»ç»ŸçŠ¶æ€**ï¼šâœ… **ç”Ÿäº§å°±ç»ª**

---

ç‰ˆæœ¬ï¼š2.1.3 (Bugfix - æ—¥æœŸæ ¼å¼)
æ—¥æœŸï¼š2025-02-14

# 多策略量化回测系统 - 使用指南

## 系统概述

本系统实现了4套回测策略，支持灵活切换和参数调整。

### 策略列表

#### 1. 量能突破回踩策略 (volume_breakout)
- **适用场景**: 适合所有市场环境
- **特点**: 基于30日均线、量能放大和5日线回踩的经典策略
- **交易频率**: 中频（每周1-2笔）
- **风险等级**: 中低

**核心参数**:
- `ma_period`: 30日均线周期（默认30）
- `retest_period`: 5日线回踩周期（默认5）
- `hold_days`: 持有天数（默认3）
- `volume_multiplier`: 量能倍数（默认3.0）

**适用人群**: 初学者、保守投资者

---

#### 2. 稳健型趋势跟踪策略 (steady_trend)
- **适用场景**: 强趋势市场、明确的上升趋势
- **特点**: 低频交易、趋势跟随、严格风控
- **交易频率**: 低频（月1-2笔）
- **风险等级**: 低

**核心参数**:
- `ma_short`: 短期均线（默认30）
- `ma_long`: 长期均线（默认60）
- `ma_filter`: 趋势滤波均线（默认120）
- `volume_multiplier`: 量能倍数（默认1.5）
- `stop_loss`: 止损幅度（默认0.08 = 8%）
- `take_profit`: 止盈幅度（默认0.15 = 15%）
- `trailing_stop`: 移动止盈幅度（默认0.05 = 5%）

**买入条件**:
1. 收盘价 > 120日均线（趋势向上）
2. 30日线 > 60日线（黄金交叉）
3. 成交量 > 20日均量 × 1.5倍（量能放大）
4. MACD DIF > DEA（动量向上）

**止损止盈**:
- 固定止损: -8%
- 固定止盈: +15%
- 移动止盈: 回调5%

**适用人群**: 保守型、长期投资者

---

#### 3. 激进型突破动量策略 (aggressive_momentum)
- **适用场景**: 创业板、科创板、高成长股
- **特点**: 高频交易、快进快出、动量驱动
- **交易频率**: 高频（周3-5笔）
- **风险等级**: 高

**核心参数**:
- `breakout_period`: 突破周期（默认20）
- `breakout_threshold`: 突破幅度（默认0.03 = 3%）
- `rsi_period`: RSI周期（默认6）
- `rsi_threshold`: RSI强势线（默认50）
- `volume_multiplier`: 量能倍数（默认2.5）
- `kdj_n`: KDJ周期（默认5）
- `atr_period`: ATR周期（默认14）
- `atr_stop_mult`: ATR止损倍数（默认2.0）
- `max_hold_days`: 最大持仓天数（默认5）
- `trailing_stop`: 移动止盈幅度（默认0.03 = 3%）

**买入条件**:
1. 突破20日高点 > 3%（价格突破）
2. 成交量 > 20日均量 × 2.5倍（量能放大）
3. RSI(6) > 50（动量强势）
4. KDJ K线 > D线（KDJ金叉）

**止损卖出**:
- ATR动态止损: 价格 < 入场价 - 2×ATR
- 时间止损: 持仓5天强制卖出
- KDJ死叉: K线 < D线 且 J > 80

**适用人群**: 激进型、短线交易者

---

#### 4. 平衡型多因子策略 (balanced_multi_factor)
- **适用场景**: 中证500、震荡市场、均衡投资
- **特点**: 多因子评分、分批建仓、智能止盈
- **交易频率**: 中频（周2-3笔）
- **风险等级**: 中

**核心参数**:
- `boll_period`: 布林带周期（默认20）
- `rsi_period`: RSI周期（默认14）
- `rsi_oversold`: RSI超卖线（默认30）
- `rsi_overbought`: RSI超买线（默认70）
- `min_factor_score`: 最低因子评分（默认0.6）
- `stop_loss`: 止损幅度（默认0.10 = 10%）
- `take_profit_1`: 第一批止盈（默认0.05 = 5%）
- `take_profit_2`: 第二批止盈（默认0.10 = 10%）
- `take_profit_final`: 最终止盈（默认0.15 = 15%）

**因子权重**:
- 布林带位置: 20%（价格偏离下轨）
- RSI超卖: 25%（RSI < 30表示超卖）
- MACD趋势: 20%（MACD正向）
- 成交量: 15%（成交量健康）
- 价格位置: 20%（20日内低位）

**买入条件**:
1. 综合因子评分 > 0.6
2. 价格接近布林带下轨（< 下轨 × 1.02）
3. RSI < 40（超卖区域）
4. MACD > 0（动量向上）

**分批止盈**:
- 第一批: +5% 卖出部分头寸
- 第二批: +10% 卖出更多头寸
- 最终: +15% 全部卖出

**适用人群**: 平衡型、稳健增长者

---

## API 使用指南

### 获取策略列表

```bash
GET /api/strategies

返回示例:
{
  "success": true,
  "strategies": [
    {
      "key": "volume_breakout",
      "name": "量能突破回踩策略",
      "description": "基于30日均线、量能放大和5日线回踩的经典策略"
    },
    ...
  ],
  "current_strategy": "volume_breakout"
}
```

### 切换策略

```bash
POST /api/strategies/current

请求体:
{
  "strategy": "steady_trend"
}

返回示例:
{
  "success": true,
  "message": "已切换到策略: 稳健型趋势跟踪策略",
  "new_params": {...}
}
```

### 获取策略参数

```bash
GET /api/strategies/<strategy_key>/params

示例: GET /api/strategies/steady_trend/params

返回示例:
{
  "success": true,
  "strategy": "steady_trend",
  "params": {
    "ma_short": 30,
    "ma_long": 60,
    "ma_filter": 120,
    ...
  }
}
```

### 运行回测（指定策略）

```bash
POST /api/backtest/cache

请求体:
{
  "symbols": ["000001", "000002"],
  "strategy": "steady_trend",
  "params": null  // 如果为null，使用默认参数
}

返回示例:
{
  "success": true,
  "strategy": "steady_trend",
  "strategy_name": "稳健型趋势跟踪策略",
  "stocks_tested": 2,
  "total_trades": 5,
  "total_return": 8.25,
  "avg_return": 1.65,
  "win_rate": 60.0,
  "trades": [...]
}
```

---

## 参数优化建议

### 保守型投资者
推荐使用 `稳健型趋势跟踪策略`:
```python
{
  "ma_short": 20,      # 调整为更快响应
  "ma_long": 50,       # 调整为更快响应
  "ma_filter": 100,    # 保持长期趋势
  "volume_multiplier": 1.2,  # 降低量能要求
  "stop_loss": 0.06,   # 更激进的止损
  "take_profit": 0.20, # 更高的止盈目标
}
```

### 激进型交易者
推荐使用 `激进型突破动量策略`:
```python
{
  "breakout_period": 10,      # 更敏感的突破
  "breakout_threshold": 0.02, # 更低的突破幅度
  "rsi_period": 5,            # 更快的RSI反应
  "rsi_threshold": 45,        # 更低的强势线
  "volume_multiplier": 2.0,   # 量能要求适中
  "atr_stop_mult": 1.5,       # 更紧的止损
  "max_hold_days": 3,         # 更短的持仓期
}
```

### 均衡型投资者
推荐使用 `平衡型多因子策略`:
```python
{
  "rsi_oversold": 35,         # 调整超卖线
  "rsi_overbought": 65,       # 调整超买线
  "min_factor_score": 0.5,    # 降低评分要求
  "stop_loss": 0.08,          # 适中的止损
  "take_profit_final": 0.12,  # 适中的止盈
}
```

---

## 监控和维护

### 策略表现监控
1. 定期查看各策略的胜率和收益
2. 对比不同市场环境下的表现
3. 记录参数调整的效果

### 参数优化周期
- 月度: 基于交易结果评估参数有效性
- 季度: 考虑市场环境变化调整参数
- 年度: 全面回顾并优化策略框架

### 风险控制
- 始终设置止损点
- 不要过度交易
- 定期评估回撤情况
- 保持适当的仓位管理

---

## 常见问题

**Q: 哪个策略最适合我？**
A: 取决于你的风险偏好:
- 保守 → 稳健型趋势跟踪策略
- 平衡 → 平衡型多因子策略 或 量能突破回踩策略
- 激进 → 激进型突破动量策略

**Q: 参数应该多久调整一次？**
A: 根据市场表现决定。通常月度评估，如果连续亏损可以考虑调整。

**Q: 可以同时运行多个策略吗？**
A: 可以。通过API分别测试不同策略，选择最优结果。

**Q: 如何处理持续亏损？**
A: 1) 检查参数设置 2) 验证数据质量 3) 评估市场环境变化 4) 考虑切换策略

---

## 技术指标说明

### MACD（指数平滑异同平均线）
- DIF > DEA: 看涨信号
- DIF < DEA: 看跌信号
- 用于判断动量

### RSI（相对强弱指数）
- RSI > 70: 超买，考虑卖出
- RSI < 30: 超卖，考虑买入
- RSI > 50: 强势

### KDJ（随机指标）
- K > D: 看涨信号（金叉）
- K < D: 看跌信号（死叉）
- J > 80: 超买
- J < 20: 超卖

### 布林带（Bollinger Bands）
- 价格 > 上轨: 超买区域
- 价格 < 下轨: 超卖区域
- 带宽反映波动性

### ATR（平均真实波幅）
- 衡量波动性
- 用于设置动态止损
- ATR越大，波动性越大

---

## 更新日志

### V2.0 (2025-02-14)
- ✓ 新增3套回测策略
- ✓ 完善技术指标计算模块
- ✓ 实现策略动态切换
- ✓ 新增API端点支持多策略
- ✓ 优化参数配置管理

---

**文档版本**: 2.0
**最后更新**: 2025年2月14日

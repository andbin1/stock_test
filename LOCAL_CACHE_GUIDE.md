# ğŸ“¦ æœ¬åœ°æ•°æ®ç¼“å­˜ç³»ç»Ÿ - å®Œæ•´æŒ‡å—

## æ¦‚è¿°

æ‚¨ç°åœ¨æ‹¥æœ‰ä¸€ä¸ª**å®Œæ•´çš„æœ¬åœ°æ•°æ®ç¼“å­˜ç³»ç»Ÿ**ï¼Œæ”¯æŒï¼š

âœ… é¦–æ¬¡è·å–çœŸå®æ•°æ®å¹¶å­˜å‚¨åˆ°æœ¬åœ°æ•°æ®åº“
âœ… ç¦»çº¿è¿›è¡Œå›æµ‹ï¼ˆæ— éœ€æ¯æ¬¡è¿æ¥ç½‘ç»œï¼‰
âœ… å¢é‡æ›´æ–°æ•°æ®ï¼ˆåªæ›´æ–°æ–°æ•°æ®ï¼‰
âœ… Webç•Œé¢è¿›è¡Œæ•°æ®ç®¡ç†
âœ… æ‰‹åŠ¨å’Œè‡ªåŠ¨æ›´æ–°åŠŸèƒ½

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Webåº”ç”¨ (app_with_cache.py)      â”‚
â”‚  â€¢ æ•°æ®è·å–                             â”‚
â”‚  â€¢ æ‰¹é‡è·å–                             â”‚
â”‚  â€¢ æ‰‹åŠ¨æ›´æ–°                             â”‚
â”‚  â€¢ å›æµ‹                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     æ•°æ®ç®¡ç†å™¨ (DataManager)             â”‚
â”‚  â€¢ æœ¬åœ°ç¼“å­˜ç®¡ç†                         â”‚
â”‚  â€¢ SQLite æ•°æ®åº“                        â”‚
â”‚  â€¢ å¢é‡æ›´æ–°é€»è¾‘                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      SQLite æ•°æ®åº“ (data_cache/)        â”‚
â”‚  â€¢ stock_data è¡¨ (è‚¡ç¥¨æ—¥çº¿æ•°æ®)         â”‚
â”‚  â€¢ update_log è¡¨ (æ›´æ–°è®°å½•)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ­¥éª¤1ï¼šè·å–æ•°æ®ï¼ˆé¦–æ¬¡ï¼‰

**æ–¹å¼1ï¼šå‘½ä»¤è¡Œè·å–**
```bash
# è·å–å¹¶ç¼“å­˜å•åªè‚¡ç¥¨
python data_manager.py fetch 000001

# æŸ¥çœ‹ç¼“å­˜çŠ¶æ€
python data_manager.py status

# æ‰¹é‡è·å–20åªè‚¡ç¥¨
python fetch_data_batch.py
```

**æ–¹å¼2ï¼šWebç•Œé¢è·å–**
```bash
# å¯åŠ¨Webåº”ç”¨
python app_with_cache.py

# æ‰“å¼€æµè§ˆå™¨: http://localhost:5000
# è¾“å…¥è‚¡ç¥¨ä»£ç ï¼Œç‚¹å‡»"è·å–æ•°æ®"
```

### æ­¥éª¤2ï¼šç¦»çº¿å›æµ‹

```bash
# ä½¿ç”¨æœ¬åœ°ç¼“å­˜æ•°æ®è¿›è¡Œå›æµ‹
python backtest_with_cache.py

# æˆ–é€šè¿‡Webç•Œé¢: http://localhost:5000
```

### æ­¥éª¤3ï¼šæ›´æ–°æ•°æ®

```bash
# å¢é‡æ›´æ–°ï¼ˆåªæ›´æ–°æ–°æ•°æ®ï¼‰
python data_manager.py update 000001

# æˆ–åœ¨Webç•Œé¢ç‚¹å‡»"å¢é‡æ›´æ–°"æŒ‰é’®
```

---

## ğŸ“Š æ•°æ®ç®¡ç†å‘½ä»¤

### æŸ¥çœ‹ç¼“å­˜çŠ¶æ€
```bash
python data_manager.py status
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
======================================================================
  æ•°æ®ç¼“å­˜çŠ¶æ€
======================================================================
æ€»æ•°æ®é‡: 50000 æ¡
æ•°æ®åº“æ–‡ä»¶: ./data_cache/stock_data.db
æ•°æ®åº“å¤§å°: 15.25 MB

æ›´æ–°æ—¥å¿—:
  000001: 250æ¡ (æœ€åæ›´æ–°: 2025-02-13)
  600000: 250æ¡ (æœ€åæ›´æ–°: 2025-02-13)
  000858: 248æ¡ (æœ€åæ›´æ–°: 2025-02-13)
```

### è·å–å•åªè‚¡ç¥¨
```bash
python data_manager.py fetch 000001
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
â³ 000001: æ­£åœ¨ä»ç½‘ç»œè·å–æ•°æ®...
âœ“ 000001: å·²ä¿å­˜ 250 æ¡æ•°æ®åˆ°æœ¬åœ°ç¼“å­˜
```

### å¢é‡æ›´æ–°æ•°æ®
```bash
python data_manager.py update 000001
```

**åŸç†**ï¼š
- æŸ¥è¯¢æœ¬åœ°æœ€æ–°æ—¥æœŸ
- ä»ä¸‹ä¸€ä¸ªäº¤æ˜“æ—¥å¼€å§‹è·å–
- åªä¿å­˜æ–°æ•°æ®ï¼Œä¸é‡å¤å­˜å‚¨

### å¯¼å‡ºæ•°æ®ä¸ºCSV
```bash
python data_manager.py export 000001
```

**è¾“å‡º**ï¼š`data_export/000001_data.csv`

### æ¸…ç©ºç¼“å­˜
```bash
# æ¸…ç©ºå•åªè‚¡ç¥¨
python data_manager.py clear 000001

# æ¸…ç©ºæ‰€æœ‰ç¼“å­˜
python data_manager.py clear
```

---

## ğŸŒ Webåº”ç”¨ä½¿ç”¨

### å¯åŠ¨åº”ç”¨
```bash
pip install flask flask-cors
python app_with_cache.py
```

è®¿é—®ï¼š`http://localhost:5000`

### åŠŸèƒ½1ï¼šæ•°æ®è·å–

1. è¾“å…¥è‚¡ç¥¨ä»£ç ï¼ˆå¦‚ `000001`ï¼‰
2. ç‚¹å‡»"è·å–æ•°æ®"æŒ‰é’®
3. ç­‰å¾…å®Œæˆï¼ˆé¦–æ¬¡è¾ƒæ…¢ï¼Œæ•°æ®ä¿å­˜åˆ°æœ¬åœ°ï¼‰
4. æŸ¥çœ‹ç»“æœ

### åŠŸèƒ½2ï¼šæ‰¹é‡è·å–

1. ç‚¹å‡»"æ‰¹é‡è·å–20åªè‚¡ç¥¨"æŒ‰é’®
2. ç³»ç»Ÿè‡ªåŠ¨è·å–ä¸­è¯500å‰20åªè‚¡ç¥¨çš„æ•°æ®
3. åå°è¿è¡Œï¼Œæ— éœ€ç­‰å¾…

### åŠŸèƒ½3ï¼šç¦»çº¿å›æµ‹

1. è¾“å…¥è‚¡ç¥¨ä»£ç ï¼ˆå¤šä¸ªç”¨é€—å·åˆ†éš”ï¼‰
2. ç‚¹å‡»"è¿è¡Œå›æµ‹"æŒ‰é’®
3. å³æ—¶æ˜¾ç¤ºç»Ÿè®¡ç»“æœ

### åŠŸèƒ½4ï¼šæ•°æ®ç®¡ç†

1. åˆ‡æ¢åˆ°"çŠ¶æ€"æ ‡ç­¾é¡µ
2. æŸ¥çœ‹ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯
3. æŸ¥çœ‹æ¯åªè‚¡ç¥¨çš„æ›´æ–°è®°å½•
4. æ¸…ç©ºä¸éœ€è¦çš„ç¼“å­˜

---

## ğŸ’¾ æ•°æ®åº“ç»“æ„

### è¡¨1: stock_dataï¼ˆè‚¡ç¥¨æ—¥çº¿æ•°æ®ï¼‰
```sql
CREATE TABLE stock_data (
    id INTEGER PRIMARY KEY,
    symbol TEXT NOT NULL,           -- è‚¡ç¥¨ä»£ç 
    date TEXT NOT NULL,             -- äº¤æ˜“æ—¥æœŸ
    open REAL,                      -- å¼€ç›˜ä»·
    close REAL,                     -- æ”¶ç›˜ä»·
    high REAL,                      -- æœ€é«˜ä»·
    low REAL,                       -- æœ€ä½ä»·
    volume REAL,                    -- æˆäº¤é‡
    amount REAL,                    -- æˆäº¤é¢
    amplitude REAL,                 -- æŒ¯å¹…
    pct_change REAL,                -- æ¶¨è·Œå¹…
    change REAL,                    -- æ¶¨è·Œé¢
    turnover_rate REAL,             -- æ¢æ‰‹ç‡
    UNIQUE(symbol, date)            -- å”¯ä¸€çº¦æŸ
)
```

### è¡¨2: update_logï¼ˆæ›´æ–°è®°å½•ï¼‰
```sql
CREATE TABLE update_log (
    id INTEGER PRIMARY KEY,
    symbol TEXT NOT NULL,           -- è‚¡ç¥¨ä»£ç 
    last_update TEXT,               -- æœ€åæ›´æ–°æ—¶é—´
    last_date TEXT,                 -- æœ€åæ•°æ®æ—¥æœŸ
    record_count INTEGER            -- è®°å½•æ•°
)
```

---

## ğŸ”„ å·¥ä½œæµç¨‹ç¤ºä¾‹

### åœºæ™¯1ï¼šé¦–æ¬¡ä½¿ç”¨

```bash
# 1. è·å–ä¸­è¯500çš„20åªè‚¡ç¥¨æ•°æ®
python fetch_data_batch.py

# 2. ç­‰å¾…å®Œæˆï¼ˆ5-10åˆ†é’Ÿï¼Œå–å†³äºç½‘ç»œï¼‰
# âœ“ æˆåŠŸè·å– 20 åªè‚¡ç¥¨çš„æ•°æ®

# 3. è¿›è¡Œå›æµ‹
python backtest_with_cache.py

# 4. æŸ¥çœ‹ç»“æœ
# ğŸ“Š ç”Ÿæˆçš„æ–‡ä»¶:
#   â€¢ å›æµ‹æ±‡æ€»_ä¸­è¯500.csv
#   â€¢ è¯¦ç»†äº¤æ˜“_ä¸­è¯500.csv
#   â€¢ å›æµ‹æŠ¥å‘Š_ä¸­è¯500_*.xlsx
```

### åœºæ™¯2ï¼šæ¯æ—¥æ›´æ–°

```bash
# 1. æ¯å¤©æ—©ä¸Šå¸‚åœºå¼€ç›˜å‰æ›´æ–°æ•°æ®
python data_manager.py update 000001
python data_manager.py update 600000
# ... æ›´æ–°æ‰€æœ‰éœ€è¦çš„è‚¡ç¥¨

# 2. è¿›è¡Œæ–°ä¸€å¤©çš„å›æµ‹
python backtest_with_cache.py

# 3. æŸ¥çœ‹ä»Šå¤©çš„äº¤æ˜“ä¿¡å·
```

### åœºæ™¯3ï¼šè°ƒæ•´å‚æ•°å¹¶å¯¹æ¯”

```bash
# 1. ä¿®æ”¹ç­–ç•¥å‚æ•°
# ç¼–è¾‘ config.py:
# STRATEGY_PARAMS['volume_multiplier'] = 2.0  # æ”¹ä¸º2.0

# 2. ä½¿ç”¨ç›¸åŒæ•°æ®è¿›è¡Œå›æµ‹
python backtest_with_cache.py

# 3. å¯¹æ¯”ç»“æœ
# çœ‹æ˜¯å¦æœ‰æ›´å¤šäº¤æ˜“ä¿¡å·
```

---

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

| æ“ä½œ | é¦–æ¬¡ï¼ˆç½‘ç»œï¼‰ | åç»­ï¼ˆç¼“å­˜ï¼‰ | åŠ é€Ÿå€æ•° |
|------|-----------|-----------|-------|
| å•åªè‚¡ç¥¨ | 5-10ç§’ | 100ms | 50-100x |
| 20åªè‚¡ç¥¨ | 2-5åˆ†é’Ÿ | 500ms | 200-600x |
| å›æµ‹ | 5-10ç§’ | 3-5ç§’ | 1-2x |

**ä¼˜åŠ¿**ï¼š
- âœ… æ— éœ€æ¯æ¬¡éƒ½è¿æ¥ç½‘ç»œ
- âœ… å¿«é€Ÿå›æµ‹ï¼ˆç§’çº§ï¼‰
- âœ… å¯ç¦»çº¿ä½¿ç”¨
- âœ… æ”¯æŒå‚æ•°å¯¹æ¯”

---

## ğŸ” æ•°æ®ç®¡ç†æœ€ä½³å®è·µ

### 1. å®šæœŸæ›´æ–°æ•°æ®
```bash
# æ¯å‘¨æ›´æ–°ä¸€æ¬¡
python data_manager.py update 000001
```

### 2. å®šæœŸå¤‡ä»½
```bash
# å¤åˆ¶æ•°æ®åº“æ–‡ä»¶
cp ./data_cache/stock_data.db ./backup/stock_data_$(date +%Y%m%d).db
```

### 3. ç›‘æ§æ•°æ®åº“å¤§å°
```bash
python data_manager.py status | grep "æ•°æ®åº“å¤§å°"
```

### 4. æ¸…ç†ä¸éœ€è¦çš„æ•°æ®
```bash
# åˆ é™¤ä¸å†ä½¿ç”¨çš„è‚¡ç¥¨
python data_manager.py clear 000001
```

---

## ğŸš¨ å¸¸è§é—®é¢˜

### Q1: æ•°æ®åº“æ–‡ä»¶åœ¨å“ªï¼Ÿ
A: `./data_cache/stock_data.db`

### Q2: å¦‚ä½•å¯¼å…¥å·²æœ‰æ•°æ®ï¼Ÿ
A: ä½¿ç”¨ `data_manager.py fetch` é‡æ–°ä¸‹è½½

### Q3: å¯ä»¥è·¨ç”µè„‘å…±äº«æ•°æ®åº“ï¼Ÿ
A: å¯ä»¥ï¼Œå¤åˆ¶ `data_cache/` ç›®å½•åˆ°å¦ä¸€å°ç”µè„‘

### Q4: æ•°æ®åº“æŸåäº†æ€ä¹ˆåŠï¼Ÿ
A: åˆ é™¤åé‡æ–°è·å–
```bash
rm ./data_cache/stock_data.db
python fetch_data_batch.py
```

### Q5: æ›´æ–°æ•°æ®æ—¶å¾ˆæ…¢ï¼Ÿ
A: æ­£å¸¸ï¼Œç½‘ç»œé€Ÿåº¦å–å†³äºæ‚¨çš„è¿æ¥ã€‚å¯ç”¨ `Ctrl+C` å–æ¶ˆ

### Q6: å¯ä»¥åŒæ—¶è·å–å¤šåªè‚¡ç¥¨ï¼Ÿ
A: å¯ä»¥ï¼Œä½¿ç”¨ `batch_fetch_data.py` æˆ–Webç•Œé¢

---

## ğŸ’¡ é«˜çº§ç”¨æ³•

### 1. è‡ªåŠ¨æ¯æ—¥æ›´æ–°

åˆ›å»º `update_daily.py`ï¼š
```python
import schedule
import time
from data_manager import DataManager

manager = DataManager()
stocks = ['000001', '600000', '000858']  # éœ€è¦æ›´æ–°çš„è‚¡ç¥¨

def update_all():
    for stock in stocks:
        manager.update_single_stock(stock)

# æ¯å¤©ä¸‹åˆ4ç‚¹æ›´æ–°
schedule.every().day.at("16:00").do(update_all)

while True:
    schedule.run_pending()
    time.sleep(60)
```

è¿è¡Œï¼š`python update_daily.py`

### 2. å¯¼å‡ºæ•°æ®ç”¨äºåˆ†æ
```bash
# å¯¼å‡ºå•åªè‚¡ç¥¨
python data_manager.py export 000001

# ä½¿ç”¨Pythonåˆ†æ
import pandas as pd
df = pd.read_csv('data_export/000001_data.csv')
print(df.describe())
```

### 3. é›†æˆåˆ°Streamlit

```python
from data_manager import DataManager

manager = DataManager()

stock_code = st.text_input("è¾“å…¥è‚¡ç¥¨ä»£ç ")
if st.button("ä»ç¼“å­˜åŠ è½½"):
    df = manager.get_data_from_cache(stock_code)
    st.dataframe(df)
```

---

## ğŸ“¦ æ–‡ä»¶æ¸…å•

```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ data_manager.py              # æ•°æ®ç®¡ç†æ ¸å¿ƒæ¨¡å—
â”œâ”€â”€ fetch_data_batch.py          # æ‰¹é‡è·å–è„šæœ¬
â”œâ”€â”€ backtest_with_cache.py       # ä½¿ç”¨ç¼“å­˜è¿›è¡Œå›æµ‹
â”œâ”€â”€ app_with_cache.py            # Webåº”ç”¨ï¼ˆé›†æˆç¼“å­˜ï¼‰
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ index_with_cache.html    # Webå‰ç«¯
â””â”€â”€ data_cache/                  # æ•°æ®å­˜å‚¨ç›®å½•
    â”œâ”€â”€ stock_data.db            # SQLiteæ•°æ®åº“
    â””â”€â”€ cache/                   # ä¸´æ—¶ç¼“å­˜
```

---

## ğŸ¯ å»ºè®®ä½¿ç”¨åœºæ™¯

### âœ… é€‚åˆä½¿ç”¨æœ¬åœ°ç¼“å­˜
- é¢‘ç¹å›æµ‹åŒä¸€æ‰¹è‚¡ç¥¨
- å‚æ•°è°ƒä¼˜å’Œå¯¹æ¯”
- æ²¡æœ‰å®æ—¶æ›´æ–°éœ€æ±‚
- ç¦»çº¿ç¯å¢ƒ

### âŒ ä¸é€‚åˆä½¿ç”¨æœ¬åœ°ç¼“å­˜
- éœ€è¦å®æ—¶è¡Œæƒ…
- éœ€è¦T+1å®æ—¶æ•°æ®
- éœ€è¦å¤šäººå…±äº«æœ€æ–°æ•°æ®

---

## ğŸ”„ è¿ç§»æŒ‡å—

### ä»ç½‘ç»œè·å–è¿ç§»åˆ°æœ¬åœ°ç¼“å­˜

**ä¹‹å‰**ï¼š
```bash
python main.py  # æ¯æ¬¡éƒ½è·å–æ–°æ•°æ®
```

**ç°åœ¨**ï¼š
```bash
# ç¬¬ä¸€æ¬¡ï¼šè·å–æ•°æ®
python fetch_data_batch.py

# åç»­ï¼šä½¿ç”¨ç¼“å­˜
python backtest_with_cache.py

# å®šæœŸæ›´æ–°ï¼š
python data_manager.py update 000001
```

---

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### å®šæœŸæ£€æŸ¥
```bash
# æ¯å‘¨æ£€æŸ¥ä¸€æ¬¡
python data_manager.py status
```

### æ¸…ç†è¿‡æœŸæ•°æ®
```bash
# åˆ é™¤ä¸å†ä½¿ç”¨çš„è‚¡ç¥¨
python data_manager.py clear 000001
```

### å¤‡ä»½é‡è¦æ•°æ®
```bash
# å¤‡ä»½æ•°æ®åº“
cp ./data_cache/stock_data.db ./backup/stock_data_backup_$(date +%Y%m%d).db
```

---

## ğŸš€ æ€»ç»“

æ‚¨ç°åœ¨æ‹¥æœ‰ï¼š

âœ… **æœ¬åœ°æ•°æ®ç¼“å­˜ç³»ç»Ÿ**
- SQLiteæ•°æ®åº“å­˜å‚¨
- è‡ªåŠ¨å¢é‡æ›´æ–°
- å¿«é€Ÿç¦»çº¿å›æµ‹

âœ… **ä¸‰ç§ä½¿ç”¨æ–¹å¼**
- å‘½ä»¤è¡Œå·¥å…·
- Webåº”ç”¨
- Pythonè„šæœ¬

âœ… **çµæ´»çš„æ•°æ®ç®¡ç†**
- è·å–ã€æ›´æ–°ã€å¯¼å‡º
- æ”¯æŒæ‰¹é‡æ“ä½œ
- å®Œæ•´çš„æ—¥å¿—è®°å½•

**ç«‹å³å¼€å§‹**ï¼š
```bash
# 1. è·å–æ•°æ®
python fetch_data_batch.py

# 2. è¿›è¡Œå›æµ‹
python backtest_with_cache.py

# 3. æŸ¥çœ‹ç»“æœ
# å®Œæˆï¼
```

---

**ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2025-02-13
**çŠ¶æ€**: âœ… å®Œå…¨å®ç°

# 📊 A股回测系统 - 完整使用指南

## 🎯 系统概览

这是一个完整的A股股票策略回测系统，支持：
- ✅ 按板块批量获取历史数据
- ✅ 灵活的时间范围配置
- ✅ 本地SQLite数据缓存
- ✅ Web界面参数配置
- ✅ 策略回测和分析
- ✅ 结果导出

---

## 🚀 快速开始（5分钟）

### 1️⃣ 启动应用
```bash
python app_with_cache.py
```

### 2️⃣ 打开浏览器
```
http://localhost:5000
```

### 3️⃣ 获取数据
```
📊 数据管理 → 选择板块 → 设置时间 → 批量获取板块数据
```

### 4️⃣ 进行回测
```
🔄 回测 → 输入股票代码 → 运行回测 → 查看结果
```

### 5️⃣ 配置参数
```
⚙️ 参数配置 → 调整参数 → 保存 → 重新回测对比
```

---

## 📊 系统功能全览

### 功能模块

#### 📥 数据管理
```
├─ 单只股票获取
│  └─ 快速验证单个股票
├─ 按板块批量获取 (新)
│  ├─ 5个主流板块选择
│  ├─ 时间范围配置
│  └─ 一次获取20只股票
├─ 快速预设获取
│  └─ 一键获取中证500
└─ 缓存管理
   ├─ 查看缓存状态
   ├─ 增量更新
   └─ 清空缓存
```

#### 🔄 回测分析
```
├─ 支持多只股票
├─ 详细交易记录
├─ 性能指标统计
│  ├─ 总交易数
│  ├─ 总收益率
│  ├─ 平均收益
│  └─ 胜率
├─ 可视化结果展示
└─ Excel导出
```

#### ⚙️ 参数配置
```
├─ Web界面配置
│  ├─ 滑块调节
│  ├─ 数值输入
│  └─ 实时对比
├─ 命令行工具
├─ Python API
└─ 参数预设系统
   ├─ 保存预设
   ├─ 加载预设
   └─ 删除预设
```

#### ℹ️ 系统状态
```
├─ 缓存统计
│  ├─ 总记录数
│  ├─ 数据库大小
│  └─ 数据库位置
├─ 更新日志
└─ 数据库清理
```

---

## 🎨 Web界面详解

### 主界面布局
```
┌─────────────────────────────────────────────────────┐
│  📈 A股回测系统              [标签页切换]             │
│  本地缓存版 - 离线回测        [参数配置导航]           │
├─────────────────────────────────────────────────────┤
│  📊 数据管理 | 🔄 回测 | ℹ️ 状态 | ⚙️ 参数配置    │
├─────────────────────────────────────────────────────┤
│                                                     │
│  [标签页内容 - 根据选择显示]                        │
│                                                     │
└─────────────────────────────────────────────────────┘
```

### 📊 数据管理标签页

#### 区域1：单只股票获取
```
┌─ 📥 单只股票获取 ─────────────────┐
│ 股票代码: [000001]                │
│ [获取数据] [增量更新]              │
│ 消息提示                           │
└────────────────────────────────────┘
```

#### 区域2：按板块批量获取（新）
```
┌─ 🔢 按板块批量获取 ────────────────┐
│ 选择板块: [创业板 ▼]               │
│ 开始日期: [2024-01-01]             │
│ 结束日期: [2025-02-13]             │
│ [批量获取板块数据]                 │
│ 消息提示                           │
└────────────────────────────────────┘
```

#### 区域3：快速获取
```
┌─ 📊 快速获取 ──────────────────────┐
│ [快速获取中证500]                  │
│ 消息提示                           │
└────────────────────────────────────┘
```

### 🔄 回测标签页

#### 回测配置
```
股票代码 (多个用,分隔): [000001,600000,000858]
[运行回测]
```

#### 回测结果
```
┌─────────┬─────────┬─────────┬─────────┐
│交易笔数 │总收益率 │平均收益 │ 胜率   │
│  5     │ +2.8%  │ +0.56% │ 80%   │
└─────────┴─────────┴─────────┴─────────┘

交易详情表格：
代码    买入日期    卖出日期    收益率
000001  2024-01-10  2024-01-13  +1.2%
```

### ⚙️ 参数配置页面

#### 参数调节
```
┌─ MA周期 ──────────────────────────┐
│ 范围: 5 ~ 250                    │
│ [═══●═══] 30 (滑块 + 输入框)     │
├────────────────────────────────────┤
│ 量能倍数: [═●═══] 3.0 (0.5 ~ 10) │
│ 回踩周期: [════●═] 5 (3 ~ 20)    │
│ 持有天数: [═══●══] 3 (1 ~ 10)    │
└────────────────────────────────────┘

[💾 保存参数] [🔄 恢复默认] [🔃 刷新页面]
```

#### 参数对比
```
当前参数          │  默认参数
ma_period: 30    │  ma_period: 30
volume_mult: 3.0 │  volume_mult: 3.0
...
```

#### 预设管理
```
已保存预设: [激进] [保守] [平衡] ...
输入预设名: [新预设名]
[💾 保存当前为预设]
```

---

## 📈 5个主流板块

### 1. 🏢 沪深A股（000001）
- **名称**：上证指数
- **范围**：沪深两市主板市场
- **特点**：最全面、最稳定
- **适合**：综合分析

### 2. 🚀 创业板（399006）
- **名称**：创业板指数
- **范围**：深交所创业板
- **特点**：高成长、高波动
- **适合**：激进策略

### 3. 🔬 科创板（000688）
- **名称**：科创板代表
- **范围**：上交所科创板
- **特点**：创新、前沿
- **适合**：科技投资

### 4. 📊 深成指（399001）
- **名称**：深圳成分指数
- **范围**：深交所主板
- **特点**：深圳代表
- **适合**：区域分析

### 5. 💰 中证500（000905）
- **名称**：中证500指数
- **范围**：中等规模企业
- **特点**：平衡性好
- **适合**：中等规模策略

---

## 🎯 常见使用场景

### 场景1：快速验证系统（新手）

**目标**：快速了解系统功能

**步骤**：
```
1. 启动应用 → python app_with_cache.py
2. 打开浏览器 → http://localhost:5000
3. 选择板块 → 中证500（或任何板块）
4. 点击"快速获取中证500" 或 "批量获取板块数据"
5. 等待数据获取完成
6. 进入回测标签，输入几只股票代码
7. 点击运行回测，查看结果
8. 完成！
```

**预计时间**：5分钟

### 场景2：多板块数据对比（中级）

**目标**：获取多个板块数据，对比策略效果

**步骤**：
```
第1次：
  板块 → 创业板
  时间 → 2024-01-01 ~ 2025-02-13
  → 批量获取板块数据

第2次：
  板块 → 科创板
  时间 → 2024-01-01 ~ 2025-02-13
  → 批量获取板块数据

第3次：
  使用"快速获取中证500"

等待所有数据获取完成后：
  → 进行回测
  → 对比不同板块的策略表现
  → 分析哪个板块更适合该策略
```

**预计时间**：20-30分钟（含等待时间）

### 场景3：参数优化（高级）

**目标**：找到最优的策略参数

**步骤**：
```
准备：
  已获取某个板块的数据

第1轮：使用默认参数回测
  进入⚙️参数配置
  查看当前参数
  点击"恢复默认"
  进行回测
  记录结果

第2轮：调整参数1
  修改 ma_period 为 20
  点击"保存参数"
  进行回测
  记录结果，对比

第3轮：调整参数2
  修改 volume_multiplier 为 2.5
  点击"保存参数"
  进行回测
  对比效果

...重复直到找到最优参数

最后：
  点击"保存当前为预设"
  命名为"最优参数"
```

**预计时间**：30-60分钟

### 场景4：定期数据更新（日常）

**目标**：保持缓存数据最新

**步骤**：
```
定期执行（如每周一次）：

  方法1（Web界面）：
    进入📊数据管理
    输入股票代码
    点击"增量更新"
    完成！

  方法2（命令行）：
    python data_manager.py update 000001
    完成！
```

---

## ⚙️ 配置说明

### 修改获取数量

编辑 `config.py`：
```python
MAX_STOCKS = 20  # 改为需要的数量
               # 如 50（获取50只），100（获取100只）
```

### 修改时间范围

编辑 `config.py`：
```python
START_DATE = "20230101"  # 开始日期
END_DATE = "20250213"    # 结束日期
```

### 修改策略参数默认值

编辑 `config.py`：
```python
STRATEGY_PARAMS = {
    "ma_period": 30,          # 30日均线
    "retest_period": 5,       # 5日线
    "hold_days": 3,           # 持有3日
    "volume_multiplier": 3.0, # 量能倍数
}
```

### 添加新的板块

编辑 `config.py`，在 `SECTORS` 字典中添加：
```python
"新板块": {
    "code": "指数代码",
    "name": "指数名称",
    "description": "描述信息"
}
```

---

## 📊 数据存储

### 数据库信息

| 项目 | 说明 |
|------|------|
| 类型 | SQLite 3 |
| 文件名 | `stock_data.db` |
| 位置 | 项目根目录 |
| 表结构 | `stock_data` (股票数据)、`update_log` (更新日志) |

### 查看缓存状态

进入 **ℹ️ 状态** 标签页：
- 总记录数：数据库中的所有数据条数
- 数据库大小：数据库文件占用的磁盘空间（MB）
- 数据库位置：完整的文件路径
- 更新日志：每只股票的更新时间和数据量

### 清理缓存

**危险操作** - 仅在需要重新下载时使用：
```
进入ℹ️状态 → 点击"清空所有缓存"
⚠️ 此操作无法撤销！
```

---

## 🔧 命令行工具

### 数据管理

```bash
# 查看缓存状态
python data_manager.py status

# 获取单只股票
python data_manager.py fetch 000001

# 增量更新股票
python data_manager.py update 000001

# 导出为CSV
python data_manager.py export 000001

# 清空缓存
python data_manager.py clear
```

### 参数管理

```bash
# 查看当前参数
python config_manager.py status

# 修改参数
python config_manager.py set ma_period 25

# 重置默认
python config_manager.py reset

# 保存预设
python config_manager.py save-preset 激进

# 加载预设
python config_manager.py load-preset 激进

# 列出预设
python config_manager.py list-presets
```

### 批量获取演示

```bash
# 运行演示脚本（需要Flask应用已启动）
python demo_fetch_by_sector.py
```

---

## 📚 完整文档目录

```
项目根目录/
├── README_NEW_FEATURES.md          ← 新增功能详解
├── DATA_FETCH_GUIDE.md              ← 数据获取完整指南
├── QUICK_START_DATA.md              ← 快速入门（30秒）
├── DATA_FETCH_UPDATE_SUMMARY.md     ← 技术更新说明
├── PARAMETER_CONFIG_GUIDE.md        ← 参数配置指南
├── SYSTEM_GUIDE.md                  ← 本文件（系统完整指南）
├── LOCAL_CACHE_GUIDE.md             ← 本地缓存说明
├── PARAMETERS_FEATURE_SUMMARY.md    ← 参数功能总结
└── ...
```

### 快速导航

| 需求 | 推荐文档 |
|------|---------|
| 想快速上手 | `QUICK_START_DATA.md` |
| 数据获取相关 | `DATA_FETCH_GUIDE.md` |
| 参数配置相关 | `PARAMETER_CONFIG_GUIDE.md` |
| 想了解新功能 | `README_NEW_FEATURES.md` |
| 技术细节 | `DATA_FETCH_UPDATE_SUMMARY.md` |
| 系统完整信息 | `SYSTEM_GUIDE.md`（本文件） |

---

## 🆘 常见问题

### Q1: 无法看到板块选择菜单？
```
A: 1. 确保Flask应用已启动
   2. 刷新浏览器（Ctrl+F5）
   3. 检查浏览器控制台是否有错误
```

### Q2: 获取数据速度很慢？
```
A: 1. 首次获取需要下载数据（正常，可能需要几分钟）
   2. 后续的增量更新会快很多
   3. 网络不稳定会影响速度
   4. 可减少MAX_STOCKS数量用于测试
```

### Q3: 某个板块获取失败？
```
A: 1. 检查网络连接
   2. 尝试单只股票获取测试
   3. 查看Flask应用的错误日志
   4. 数据源可能暂时不可用（efinance/akshare）
```

### Q4: 如何只获取特定股票？
```
A: 1. 方法1：单只股票区域，输入代码→获取数据
   2. 方法2：增量更新单只股票
   3. 方法3：获取板块数据后只回测某些股票
```

### Q5: 如何导出回测结果？
```
A: 1. 进行回测
   2. 回测结果下方有"导出"选项
   3. 结果保存为Excel文件
```

### Q6: 参数修改后需要重新获取数据吗？
```
A: 不需要！参数修改只影响回测结果
   已获取的数据保持不变
   修改参数后直接进行新的回测
```

### Q7: 如何清理旧数据，只保留某些板块？
```
A: 1. 点击"清空所有缓存"删除所有数据
   2. 重新获取需要的板块数据
   ⚠️ 一旦清空无法恢复！
```

---

## 💡 最佳实践

### 使用建议

1. **首次使用**
   ```
   从中证500开始 → 快速验证系统功能
   → 然后尝试其他板块
   ```

2. **数据获取**
   ```
   按需获取 → 不要一次获取所有数据
   → 定期增量更新 → 保持数据新鲜
   ```

3. **参数优化**
   ```
   一次改一个参数 → 对比效果
   → 进行3-5轮优化 → 找到最优值
   ```

4. **日常使用**
   ```
   早晨：增量更新数据
   → 中午：进行回测和参数优化
   → 晚上：分析结果，制定策略
   ```

5. **数据管理**
   ```
   定期检查缓存状态 → 了解数据规模
   → 定期增量更新 → 保持数据完整
   → 不需要时清理 → 节省磁盘空间
   ```

---

## 🎓 学习路径

### 初级（新手）
```
1. 快速开始 - 启动应用，获取数据
2. 简单回测 - 单只股票回测
3. 查看结果 - 理解回测指标
```

### 中级（用户）
```
1. 多板块获取 - 按板块获取数据
2. 多股票回测 - 批量股票回测
3. 参数调整 - 尝试修改参数
4. 结果对比 - 对比不同参数的效果
```

### 高级（研究者）
```
1. 参数优化 - 系统性参数优化
2. 预设管理 - 保存优化的参数组合
3. 策略分析 - 深度分析策略表现
4. 自定义配置 - 修改策略参数范围
```

---

## 🚀 下一步行动

### 立即开始
```bash
# 1. 启动应用
python app_with_cache.py

# 2. 打开浏览器
http://localhost:5000

# 3. 获取数据和进行回测
```

### 深入学习
- 阅读 `DATA_FETCH_GUIDE.md` 了解数据获取
- 阅读 `PARAMETER_CONFIG_GUIDE.md` 了解参数配置
- 运行 `demo_fetch_by_sector.py` 查看演示

### 持续优化
- 定期增量更新数据
- 尝试不同的参数组合
- 记录最优的参数预设
- 不断调整策略

---

**🎉 现在就开始吧！**

访问 **http://localhost:5000** 开始使用完整的A股回测系统！

---

**版本**：2.0
**最后更新**：2025-02-13
**状态**：✅ 完全功能

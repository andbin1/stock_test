# 📖 使用示例 - 按板块获取数据

## 快速开始

### 启动应用
```bash
python app_with_cache.py
```

### 打开浏览器
```
http://localhost:5000
```

---

## 场景1：快速测试（获取10只股票）

**目标**：快速验证系统，5分钟内完成

**步骤**：
```
1. 进入"📊 数据管理"标签
2. 板块 → 中证500
3. 时间 → 默认 (2024-01-01 ~ 2025-02-13)
4. 数量 → 10
5. 点击"获取数据"
6. 等待完成（约2-3分钟）
7. 进行回测验证
```

**预期结果**：
```
✓ 已开始获取中证500(10只股票)，首批: 000630, 000650, 000858...
```

---

## 场景2：板块分析（获取50只股票）

**目标**：完整分析某个板块的策略表现

**步骤**：
```
第1次：获取创业板
├─ 板块 → 创业板
├─ 时间 → 2024-01-01 ~ 2025-02-13
├─ 数量 → 50
└─ 点击"获取数据"

第2次：进行回测
├─ 🔄 回测标签
├─ 股票代码 → 300001 (或多个)
├─ 点击"运行回测"
└─ 查看结果

第3次：调整参数
├─ ⚙️ 参数配置
├─ 修改参数（如 ma_period: 25）
├─ 保存参数
└─ 返回回测对比
```

**获取进度**：
```
股票数: 50
时间: 约10-15分钟
数据库增加: 50 × 日期数
```

---

## 场景3：跨板块对比（各获取30只）

**目标**：对比不同板块的策略表现

**步骤**：
```
获取第1个板块（沪深A股）
├─ 板块 → 沪深A股
├─ 数量 → 30
└─ 获取数据

获取第2个板块（创业板）
├─ 板块 → 创业板
├─ 数量 → 30
└─ 获取数据

获取第3个板块（科创板）
├─ 板块 → 科创板
├─ 数量 → 30
└─ 获取数据

对比分析
├─ 🔄 回测标签
├─ 测试各板块的股票
├─ 对比胜率和收益
└─ 找出最适合的板块
```

**数据量**：
```
总股票数: 90
总记录数: 90 × 日期数
对比维度: 3个板块
```

---

## 场景4：完整板块获取（获取100只）

**目标**：获取完整板块数据进行深度研究

**步骤**：
```
1. 板块 → 沪深A股
2. 时间 → 完整时间范围
3. 数量 → 100
4. 点击"获取数据"
5. 等待完成（约20-30分钟）
6. 进入"ℹ️ 状态"查看统计
```

**缓存统计**：
```
总记录数：约100 × 日期数（如100 × 250 = 25,000条）
数据库大小：约20-50 MB
```

**后续分析**：
```
├─ 批量回测100只股票
├─ 分析策略胜率
├─ 找出最优参数
├─ 统计收益分布
└─ 导出结果报告
```

---

## 数量选择建议

### 按使用场景

| 场景 | 数量 | 时间 | 用途 |
|------|------|------|------|
| 快速测试 | 5-10 | 2-5分钟 | 验证系统 |
| 基础分析 | 20-30 | 5-10分钟 | 板块初步分析 |
| 深度分析 | 50-100 | 10-30分钟 | 完整策略验证 |
| 全面研究 | 100+ | 30-60分钟 | 深度研究 |

### 按数据库大小

| 数量 | 日期数* | 总记录 | 数据库大小 | 推荐 |
|------|--------|--------|----------|------|
| 10 | 250 | 2,500 | 2-5 MB | ⭐ 快速 |
| 30 | 250 | 7,500 | 5-15 MB | ⭐⭐ 推荐 |
| 50 | 250 | 12,500 | 10-25 MB | ⭐⭐⭐ 完整 |
| 100 | 250 | 25,000 | 20-50 MB | ⭐⭐⭐ 全面 |

*日期数：根据时间范围，约250个交易日/年

---

## 操作步骤详解

### 第1步：选择板块

```
选择器显示的5个板块：
├─ 🏢 沪深A股 - 最全面的数据
├─ 🚀 创业板 - 高成长公司
├─ 🔬 科创板 - 科技创新企业
├─ 📊 深成指 - 深圳主板
└─ 💰 中证500 - 平衡选择

选择技巧：
• 新手推荐：中证500（平衡性好）
• 高成长：创业板、科创板
• 稳定性：沪深A股、深成指
```

### 第2步：设置时间

```
开始日期：2024-01-01
结束日期：2025-02-13

时间范围选择：
• 1个月：快速测试
• 3个月：基础分析
• 6个月：中期分析
• 1年+：完整分析

默认时间：从2024年初到现在
可根据需要调整
```

### 第3步：指定数量

```
输入框说明：
• 最小值：1只
• 最大值：500只
• 默认值：20只
• 推荐值：30-50只

输入示例：
┌─────────────────┐
│      50         │  ← 输入50表示获取50只股票
└─────────────────┘
```

### 第4步：获取数据

```
点击"获取数据"按钮后：

① 后台启动异步任务
   状态：正在获取创业板数据...

② 系统获取成分股列表
   获取指数 399006 的成分股...
   已获取 50 只成分股

③ 逐只下载历史数据
   000001: [████████░░] 80%

④ 保存到本地数据库
   正在保存到缓存...

⑤ 完成提示
   ✓ 已开始获取创业板(50只股票)
```

---

## 查看数据获取进度

### 方法1：查看日志

```
Flask应用日志中显示：
获取指数 399006 的成分股...
  已获取 50 只成分股

正在保存数据...
000001: 保存 250 条数据
000002: 保存 250 条数据
...
```

### 方法2：查看缓存状态

```
进入"ℹ️ 状态"标签查看：

总记录数：12,500 条
数据库大小：25 MB
数据库位置：D:\ai_work\stock_test\stock_data.db

更新日志：
000001 (创业板): 250 条数据，最后数据：2025-02-13
000002 (创业板): 250 条数据，最后数据：2025-02-13
...
```

---

## 常见操作

### 修改已输入的参数

```
要修改数量：
1. 点击数量输入框
2. 清空当前值
3. 输入新值
4. 点击"获取数据"

要修改板块：
1. 点击板块下拉菜单
2. 选择不同板块
3. 点击"获取数据"

要修改时间：
1. 点击日期输入框
2. 选择新日期
3. 点击"获取数据"
```

### 获取相同板块不同数量

```
第1次获取：
数量 → 20
结果 → 20只股票已保存

第2次获取：
数量 → 50
结果 → 前50只股票已保存
（其中前20只被覆盖，后30只是新增）

建议：
直接设定所需总数，如改为50不需要重复获取
```

### 增量更新数据

```
原方式（已删除）：
需要手动输入单只股票代码更新

新方式（推荐）：
重新按板块获取，系统自动处理增量更新
所有新数据会覆盖旧数据

优势：
• 更简单（不需输入单只代码）
• 更完整（所有数据都更新）
• 更方便（一键完成）
```

---

## 回测流程

### 获取数据后立即回测

```
1. 数据获取完成

2. 进入"🔄 回测"标签

3. 输入股票代码
   单只：000001
   多只：000001,300001,688001

4. 点击"运行回测"

5. 查看结果
   ├─ 交易笔数
   ├─ 总收益率
   ├─ 平均收益
   ├─ 胜率
   └─ 详细交易表

6. 调整参数重新测试
   ⚙️ 参数配置 → 修改 → 保存 → 回到回测重新运行
```

---

## 最佳实践

### 第一次使用

```
1. 数量 → 10只（快速测试）
2. 板块 → 中证500
3. 时间 → 默认
4. 获取 → 完成
5. 回测 → 尝试
6. 参数 → 调整
```

### 日常使用

```
1. 按需选择板块和数量
2. 获取数据（后台异步）
3. 进行回测分析
4. 参数优化迭代
5. 记录最优参数
```

### 深度研究

```
1. 多板块获取（各30-50只）
2. 批量回测对比
3. 参数系统优化
4. 绘制分析图表
5. 导出研究报告
```

---

## 故障排除

### 问题1：获取数据速度很慢

```
✓ 首次获取需要下载所有数据（正常现象）
✓ 数量越多越慢（如100只需要30分钟）
✓ 网络速度影响（请检查网络）

解决：
• 先用10-20只快速测试
• 确认网络可用后再增加数量
• 可以分批获取不同板块
```

### 问题2：某个板块无法获取

```
✗ 网络连接问题
✗ 数据源暂时不可用
✗ 某些股票无历史数据

检查：
1. 网络连接是否正常
2. Flask应用日志是否有错误
3. 尝试更换板块测试
```

### 问题3：数据库变得很大

```
100只股票 × 250天 = 25,000条记录
数据库大小：20-50 MB

优化方法：
1. 清空缓存（会删除所有数据）
2. 重新获取较少的股票
3. 调整时间范围（如只要1年数据）
```

---

**现在就开始使用改进后的界面吧！** 🚀

---

版本：2.1
日期：2025-02-13

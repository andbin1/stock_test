# 🔧 解决方案：安装脚本乱码问题

## 问题描述

在另一台电脑上运行"安装依赖.bat"时出现：
- ❌ "el 不是内部或外部命令"
- ❌ 大量乱码
- ❌ 无法正常执行

## 原因分析

**根本原因**：Windows 批处理文件编码问题

原始的 `安装依赖.bat` 和 `启动应用.bat` 使用了：
- UTF-8 编码
- 中文字符
- emoji 符号（✓、❌、📦 等）

在某些 Windows 系统上，这些字符会被错误解析，导致：
- 中文变成乱码
- emoji 被解析成无效命令
- 整个脚本无法执行

---

## ✅ 解决方案

### 方案1：使用英文版脚本（推荐）

我已经创建了纯英文版本的脚本，**完全兼容所有 Windows 系统**：

#### 新的文件名：

| 原文件 | 新文件（英文版） |
|--------|-----------------|
| 安装依赖.bat | **install_dependencies.bat** |
| 启动应用.bat | **start_app.bat** |

#### 使用方法：

```
第1步：双击运行 install_dependencies.bat
第2步：双击运行 start_app.bat
第3步：浏览器访问 http://localhost:5000
```

---

### 方案2：手动命令行安装

如果脚本仍然有问题，可以手动执行命令：

#### 第1步：打开命令提示符（CMD）

1. 按 `Win + R`
2. 输入 `cmd`
3. 回车

#### 第2步：进入项目目录

```cmd
cd /d D:\path\to\stock_test
```

（将路径替换为你解压的实际位置）

#### 第3步：检查 Python

```cmd
python --version
```

如果提示"不是内部或外部命令"，说明：
- Python 未安装
- 或 Python 未添加到系统环境变量

**解决方法**：
1. 下载安装 Python 3.8+：https://www.python.org/downloads/
2. **重要**：安装时勾选 "Add Python to PATH"

#### 第4步：升级 pip

```cmd
python -m pip install --upgrade pip
```

#### 第5步：安装依赖

```cmd
pip install -r requirements_release.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

如果清华镜像失败，可以尝试：

```cmd
# 使用官方源
pip install -r requirements_release.txt

# 或使用阿里云镜像
pip install -r requirements_release.txt -i https://mirrors.aliyun.com/pypi/simple/
```

#### 第6步：启动应用

```cmd
python app_with_cache.py
```

#### 第7步：访问应用

打开浏览器，访问：`http://localhost:5000`

---

### 方案3：修复原脚本编码（高级）

如果你想继续使用中文版脚本：

#### Windows 10/11 用户：

1. 右键点击 `安装依赖.bat`
2. 选择"编辑"
3. 另存为时，选择编码：**ANSI** 或 **GBK**
4. 保存并运行

#### 或者在脚本中添加编码声明：

在 `.bat` 文件第一行添加：
```batch
@echo off
chcp 936
```

然后另存为 **ANSI** 编码。

---

## 📋 完整的手动安装步骤（适用于所有情况）

### 环境准备

1. **安装 Python 3.8+**
   - 下载：https://www.python.org/downloads/
   - ✅ **勾选** "Add Python to PATH"
   - 安装完成后重启命令提示符

2. **下载项目**
   - 从 GitHub 克隆：`git clone https://github.com/andbin1/stock_test.git`
   - 或下载 ZIP 并解压

### 安装依赖

```cmd
# 1. 进入项目目录
cd stock_test

# 2. （可选）创建虚拟环境
python -m venv venv
venv\Scripts\activate

# 3. 安装依赖
pip install -r requirements_release.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### 启动应用

```cmd
# 启动 Flask 应用
python app_with_cache.py

# 看到以下提示表示成功：
# * Running on http://127.0.0.1:5000
```

### 访问应用

浏览器打开：`http://localhost:5000`

---

## 🔍 故障排查

### Q1: 提示 "python 不是内部或外部命令"

**原因**：Python 未安装或未添加到 PATH

**解决**：
1. 重新安装 Python
2. 安装时勾选 "Add Python to PATH"
3. 或手动添加 Python 到系统环境变量

### Q2: pip 安装依赖超时

**原因**：网络问题或镜像源慢

**解决**：
```cmd
# 更换镜像源
pip install -r requirements_release.txt -i https://mirrors.aliyun.com/pypi/simple/

# 或使用官方源（国外）
pip install -r requirements_release.txt
```

### Q3: 提示 "ModuleNotFoundError: No module named 'flask'"

**原因**：依赖未正确安装

**解决**：
```cmd
# 单独安装 Flask
pip install flask flask-cors

# 然后安装其他依赖
pip install -r requirements_release.txt
```

### Q4: 端口 5000 被占用

**现象**：
```
Address already in use
Port 5000 is in use by another program
```

**解决**：
```cmd
# 方法1：关闭占用端口的程序
netstat -ano | findstr :5000
taskkill /PID <进程ID> /F

# 方法2：修改端口
# 编辑 app_with_cache.py 最后一行：
# app.run(debug=False, host='0.0.0.0', port=8080)
```

---

## 📝 推荐的标准流程

### 首次安装（使用英文版脚本）

```
1. 解压项目文件
2. 双击 install_dependencies.bat
3. 等待安装完成
4. 双击 start_app.bat
5. 浏览器访问 http://localhost:5000
```

### 如果脚本失败（使用命令行）

```
1. 打开 CMD
2. cd 到项目目录
3. python -m pip install -r requirements_release.txt
4. python app_with_cache.py
5. 浏览器访问 http://localhost:5000
```

---

## 🎯 验证安装是否成功

运行以下命令验证：

```cmd
# 检查 Python 版本
python --version
# 应该显示：Python 3.8.x 或更高

# 检查依赖包
python -c "import flask, pandas, numpy; print('OK')"
# 应该显示：OK

# 测试启动（不会真正启动，只是检查语法）
python -m py_compile app_with_cache.py
# 无输出表示成功
```

---

## 📞 仍然有问题？

如果按照以上步骤仍然无法解决，请提供以下信息：

1. **操作系统版本**：Windows 10 还是 11？
2. **Python 版本**：`python --version` 的输出
3. **错误截图**：完整的错误信息
4. **安装日志**：运行命令的完整输出

---

## ✅ 更新 GitHub 仓库

为了让其他用户也能使用，我建议将英文版脚本推送到 GitHub：

```cmd
cd D:\ai_work\stock_test
git add install_dependencies.bat start_app.bat
git commit -m "Add English version scripts to fix encoding issues"
git push
```

然后更新 README.md，说明两种启动方式：

```markdown
## 快速开始

### 方法1：使用英文版脚本（推荐，兼容性好）
1. 双击 install_dependencies.bat
2. 双击 start_app.bat

### 方法2：使用中文版脚本
1. 双击 安装依赖.bat
2. 双击 启动应用.bat

如果中文版出现乱码，请使用方法1。
```

---

**希望这能解决你的问题！**

如果还有疑问，请告诉我具体的错误信息。
